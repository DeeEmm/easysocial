EasySocial.module("admin/migrators/migrator",function(){var b=this;EasySocial.require().script("admin/progress/progress").done(function(a){EasySocial.Controller("Migrators.Migrator",{defaultOptions:{component:null,processState:0,progressController:null,mapping:null,updateconfig:0,"{initiateButton}":"[data-initiate-migration]","{progressBar}":"[data-progress]","{results}":".scannedResult","{viewLog}":".viewLog","{customFieldsMap}":"[data-custom-fields-map]","{resultForm}":"[data-migration-result]","{startWidget}":"[data-start-widget]","{fieldItem}":"[data-field-item]","{startMigrationButton}":"[data-start-migration]","{rows}":"[data-row-item]","{selection}":"[data-field-item]","{jomsocialBackButton}":"[data-jomsocial-back-button]"}},function(b){return{init:function(){b.initProgressBar(),b.initLogging()},showCustomFields:function(){b.startWidget().slideUp(),b.customFieldsMap().slideDown()},showResultForm:function(){b.customFieldsMap().slideUp(),"com_community"!=b.options.component&&b.startWidget().slideUp(),b.resultForm().slideDown()},startMigration:function(){b.showResultForm(),1!=b.options.processState&&(b.options.processState=1,b.reset(),EasySocial.ajax("admin/controllers/migrators/check",{component:b.options.component}).done(function(a){a.isvalid?(b.options.progressController.begin(a.count),b.startIterating("")):(b.results().show(),b.addLog("Error: "+a.message),b.options.processState=0)}))},reset:function(){b.results().empty(),b.initLogging(),b.options.progressController.reset()},initLogging:function(){b.viewLog().hide()},initProgressBar:function(){b.progressBar().implement(EasySocial.Controller.Progress),b.options.progressController=b.progressBar().controller()},addLog:function(c){a("<li>").html(c).appendTo(b.results())},startIterating:function(c){null==b.options.mapping&&b.selection().length>0&&(b.options.mapping=a("#adminForm").serializeArray()),EasySocial.ajax("admin/controllers/migrators/process",{component:b.options.component,item:c,mapping:b.options.mapping,updateconfig:b.options.updateconfig}).always(function(a,c){b.options.updateconfig=c,a["continue"]?(b.options.progressController.touch("Discovering..."),b.addLog(a.message),b.startIterating(a.item)):(b.options.progressController.touch("Discover Completed"),b.addLog(a.message),b.addLog("migration process completed."),b.viewLog().show(),b.jomsocialBackButton().show(),b.options.processState=0)})},"{fieldItem} change":function(b){var c=a(b).val();""==c?a(b).parents("[data-row-item]").removeClass("success").addClass("error"):a(b).parents("[data-row-item]").removeClass("error").addClass("success")},"{startMigrationButton} click":function(){b.selection().length>0&&b.selection().each(function(b,c){""==a(c).val()?a(c).parents("[data-row-item]").removeClass("success").addClass("error"):a(c).parents("[data-row-item]").removeClass("error").addClass("success")});var c=b.rows().hasClass("error");c?EasySocial.dialog({content:EasySocial.ajax("admin/views/migrators/confirmMigration"),bindings:{"{submitButton} click":function(){b.startMigration(),EasySocial.dialog().close()}}}):b.startMigration()},"{initiateButton} click":function(){b.showCustomFields()},"{viewLog} click":function(){b.results().toggle()}}}),b.resolve()})});
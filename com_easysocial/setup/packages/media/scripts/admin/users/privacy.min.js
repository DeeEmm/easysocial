EasySocial.module("admin/users/privacy",function(){var b=this;EasySocial.require().library("textboxlist").done(function(a){EasySocial.Controller("Profile.Privacy",{defaultOptions:{userId:"","{privacyItem}":"[data-privacy-item]","{privacyForm}":"[data-profile-privacy-form]","{defaultFieldInput}":"[data-default-privacy-field]","{defaultFieldEdit}":"[data-default-field-edit]"}},function(a){return{init:function(){a.privacyItem().implement(EasySocial.Controller.Profile.Privacy.Item,{"{parent}":a})},"{defaultFieldEdit} click":function(){var b=a.defaultFieldInput().val(),c=a.privacyItem().controller();c.editField(b,!0,a.defaultFieldInput())}}}),EasySocial.Controller("Profile.Privacy.Item",{defaultOptions:{"{selection}":"[data-privacy-select]","{hiddenCustom}":"[data-hidden-custom]","{hiddenField}":"[data-hidden-field]","{customForm}":"[data-privacy-custom-form]","{customTextInput}":"[data-textfield]","{customItems}":"input[]","{customHideBtn}":"[data-privacy-custom-hide-button]","{customInputItem}":"[data-textboxlist-item]","{customEditBtn}":"[data-privacy-custom-edit-button]","{fieldEdit}":"[data-privacy-field]"}},function(b){return{init:function(){b.customTextInput().length>0&&(b.customTextInput().textboxlist({component:"es",unique:!0,plugin:{autocomplete:{exclusive:!0,minLength:2,cache:!1,query:function(a){var c=b.getTaggedUsers(),d=EasySocial.ajax("site/views/privacy/getfriends",{q:a,userid:b.parent.options.userId,exclude:c});return d}}}}),b.textboxlistLib=b.customTextInput().textboxlist("controller"))},getTaggedUsers:function(){var c=[],d=b.customInputItem();return d.length>0&&a.each(d,function(b,d){c.push(a(d).data("id"))}),c},"{customTextInput} addItem":function(a,c,d){var e=b.hiddenCustom().val(),f="";if(""==e)f=d.id;else{var g=e.split(",");g.push(d.id),f=g.join(",")}b.hiddenCustom().val(f)},"{customTextInput} removeItem":function(a,c,d){for(var e=b.hiddenCustom().val(),f="",g=[],h=e.split(","),i=0;i<h.length;i++)h[i]!=d.id&&g.push(h[i]);f=g.length<=0?"":g.join(","),b.hiddenCustom().val(f)},"{customEditBtn} click":function(){b.customForm().toggle()},"{selection} change":function(a){var c=a.val();"custom"==c?(b.customForm().show(),b.customEditBtn().show()):(b.customForm().hide(),b.customEditBtn().hide())},"{customHideBtn} click":function(){b.customForm().hide(),b.customEditBtn().show(),b.textboxlistLib.autocomplete.hide()},"{fieldEdit} click":function(){var a=b.hiddenField().val();b.editField(a,!0,b.hiddenField())},editField:function(b,c,d){var e=[],f=!1,g=[];if(void 0==c&&(c=!1),b)var g=b.split(",");EasySocial.dialog({content:EasySocial.ajax("admin/views/privacy/fields",{selected:b,isDefault:c?1:0}),selectors:{"{addFieldButton}":"[data-field-add]","{removeFieldButton}":"[data-field-remove]","{fieldTemplate}":"[data-field-template]","{fieldWrapper}":"[data-field-wrapper]","{fieldSelect}":"[data-field-item] [data-field-select]","{tmplFieldSelect}":"[data-field-template] [data-field-select]","{fieldItem}":"[data-field-item]"},bindings:{"{addFieldButton} click":function(){var a=this.fieldTemplate().clone();a.removeAttr("data-field-template").removeClass("t-hidden").attr("data-field-item","").appendTo(this.fieldWrapper())},"{removeFieldButton} click":function(b){if(this.fieldItem().length>1){var c=a(b).closest("[data-field-item]").find("[data-field-select]").val();if(a.inArray(c,g)>=0){var d=[];a.each(g,function(a,b){b!=c&&d.push(b)}),g=d}a(b).closest("[data-field-item]").remove()}},"{fieldSelect} change":function(b){var c=a(b).val();a(b).closest("[data-field-item]").find("[data-field-notice]").addClass("t-hidden"),a.inArray(c,g)>=0?(a(b).closest("[data-field-item]").find("[data-field-notice]").removeClass("t-hidden"),a(b).val("")):g.push(c)},"{saveButton} click":function(){f=!0;var b=this.fieldSelect();a.each(b,function(b,c){var d=a(c).val();""!=d&&-1==a.inArray(d,e)&&e.push(d)}),EasySocial.dialog().close();var c="";e.length>0&&(c=e.join(","),d.val(c))}}})}}}),b.resolve()})});
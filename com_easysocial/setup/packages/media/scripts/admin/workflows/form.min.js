EasySocial.module("admin/workflows/form",function(){var b=this;EasySocial.require().library("ui/sortable","scrollTo").script("admin/workflows/choices").done(function(a){EasySocial.Controller("Workflows",{defaultOptions:{id:null,tmpSteps:null,tpls:{},fieldsValue:{},fieldsData:{},fieldsChoices:{},fieldsConditions:{},stepsValue:{},stepsHtml:{},fieldsConfigValue:{},deletedFields:{},deletedSteps:{},hiddenClass:"t-hidden","{templates}":"[data-workflow-templates]","{content}":"[data-content]","{titleInput}":"[data-input-workflow-title]","{descInput}":"[data-input-workflow-description]","{workflowConfigSave}":"[data-workflow-config-save-button]","{batchActions}":"[data-batch-actions]","{batchMove}":"[data-batch-move]","{batchDelete}":"[data-batch-delete]","{steps}":"[data-steps]","{step}":"[data-step-item]","{newStep}":"[data-step-new]","{stepTitle}":"[data-step-title]","{editStep}":"[data-step-edit]","{deleteStepButton}":"[data-step-delete]","{fields}":"[data-fields]","{field}":"[data-field-item]","{newField}":"[data-field-new]","{checkbox}":"[data-field-item-checkbox]","{moveField}":"[data-field-item-move]","{deleteField}":"[data-field-item-delete]","{editField}":"[data-field-item-edit]","{conditionalField}":"[data-field-item-conditional]","{conditionalParam}":"[data-fields-conditional-param]","{fieldRequiredSymbol}":"[data-field-item-required]","{saveFieldsInput}":"[data-fields-saved-value]","{fieldSettings}":"[data-field-settings]","{fieldParam}":"[data-fields-config-param]","{fieldBrowser}":"[data-field-browser]","{fieldBrowserClose}":"[data-field-browser-close]","{fieldsTypeTab}":"[data-field-type-tab]","{fieldTypeContent}":"[data-field-type-content]","{fieldBrowserItems}":"[data-field-browser-items]","{fieldBrowserItem}":"[data-field-browser-item]","{dialogFieldSave}":"[data-field-save-button]","{dialogFieldCancel}":"[data-field-cancel-button]","{dialogFieldTab}":"[data-field-tab]","{dialogFieldContent}":"[data-field-content]","{dialogStepSave}":"[data-field-step-save-button]","{dialogError}":"[data-dialog-error]","{dialogErrorClose}":"[data-dialog-error-close]"}},function(b,c,d){return{init:function(){c.id=b.element.data("id"),this.initTemplates(),this.initSortable(),this.initDefaultData(),this.initBindEvent(),b._setMessage=b.setMessage,b.setMessage=function(a,c,e){if(void 0==e){if(d.hasClass("is-resizing"))return;this.element.find("[data-message-group]").remove(),b._setMessage.apply(this,[a,c])}else{var f=b.getTemplate("alert"),g="o-alert--"+c,h=e.find("[data-message-group]");f.addClass(g),a||(a=h.data("message")),f.find("[data-message]").html(a),e.find("[data-message-group]").html(f)}}},initDefaultData:function(){if(!c.id||""==c.id){var d=JSON.parse(c.tmpSteps);a.each(d,function(c,d){var e=[{name:"title",value:d.title},{name:"description",value:d.description}];b.storeSteps(d.id,e),d.fields&&a.each(d.fields,function(c,d){var e=[];a.each(d,function(a,b){var c={name:a,value:b};e.push(c)}),b.storeFieldsData(d.id,e)})})}},initTemplates:function(){var d=b.templates().children();a.each(d,function(){var b=a(this),d=b.data("template");c.tpls[d]=b.html()})},initSortable:function(){this.initStepsSortable(),this.initFieldsSortable()},initStepsSortable:function(){b.steps().sortable({items:b.step.selector,cursor:"move",forceHelperSize:!0,axis:"x",update:function(){b.updateOrdering(b.step())}})},initFieldsSortable:function(){b.fields().sortable({items:b.field.selector,cursor:"move",forceHelperSize:!0,axis:"y",start:function(a,b){b.helper.addClass("is-new"),b.helper.hasClass("has-condition")&&b.helper.removeClass("has-condition").addClass("has-condition-tmp")},stop:function(a,b){setTimeout(function(){b.item.removeClass("is-new"),b.item.hasClass("has-condition-tmp")&&b.item.removeClass("has-condition-tmp").addClass("has-condition")},150)},update:function(){b.updateOrdering(b.field())}})},initBindEvent:function(){a(document).on("keyup",function(a){27==a.keyCode&&b.closeDialog()})},getTemplate:function(b){var d=a(c.tpls[b]).clone();return d},updateOrdering:function(b){a.each(b,function(){var b=a(this),c=b.index();b.attr("data-ordering",c)})},changed:!1,isChanged:function(){b.changed=!0},mandatoryCheck:function(){return b.fieldsTypeTab().filter('[id="core"]').hasClass(c.hiddenClass)},hasEmptySteps:function(){var c=b.step(),d=!1;return a.each(c,function(c,e){var e=a(e),f=e.data("id");return f?b.isStepEmpty(f)?(d=!0,!1):void 0:void 0}),d},hasDuplicateUniqueField:function(){var c=[],d=a(b.content),e=d.find(b.field);a.each(e,function(b,d){var d=a(d),e=d.data("unique");if(e){var f=d.data("element");c.push(f)}});var f=c.length;return uniqueElements=a.unique(c),f!==uniqueElements.length?!0:!1},isStepEmpty:function(c){var d=a(b.content.selector+'[data-id="'+c+'"]'),e=d.find(b.field.selector);return e.length>0?!1:!0},validate:function(){return b.mandatoryCheck()?b.hasEmptySteps()?(b.showDialogError("empty-step"),!1):b.hasDuplicateUniqueField()?(b.showDialogError("has-duplicate-unique"),!1):!0:(b.showDialogError("mandatory"),!1)},save:function(){var c=a.Deferred();if(!b.validate())return c.reject(),c;var d=b.fetchWorkflowData();return b.injectSaveData(d),c.resolve(),c},getAvailableFields:function(){return b.fetchWorkflowData(!0,!0)},fetchWorkflowData:function(d,e){var f=[],g=0,h=b.step();d&&(h=b.getCurrentStep()),a.each(h,function(d,h){var h=a(h),i=a(b.content.selector+'[data-id="'+h.data("id")+'"]'),j=[],k=[],l=i.find(b.field.selector);if(l.length>0){var m=0;if(a.each(l,function(b,d){var d=a(d);if(e)var f={fieldTitle:d.find("[data-field-item-title]").html(),fieldId:d.data("id"),fieldElement:d.data("element"),appId:d.data("appid")};else var f={fieldTitle:d.find("[data-field-item-title]").html(),fieldId:d.data("id"),fieldElement:d.data("element"),appId:d.data("appid"),ordering:m,isNew:d.data("isnew"),params:c.fieldsValue[d.data("id")]};k.push(f),m++}),e)var j={stepId:h.data("id"),fields:k};else var j={stepId:h.data("id"),ordering:g,isNew:h.data("isnew"),params:c.stepsValue[h.data("id")],fields:k};f.push(j),g++}else h.data("id")&&(void 0===b.deletedSteps&&(b.deletedSteps=[]),b.deletedSteps.push(h.data("id")))});var i={steps:b.deletedSteps,field:b.deletedFields},j={steps:f,deleted:i};return j},deselectFields:function(){b.fields().find(b.checkbox.selector+":checked").attr("checked",!1).trigger("change")},getSelectedFields:function(){var c=b.fields().find(b.checkbox.selector+":checked");if(c.length<=0)return!1;var d=[];return c.each(function(c,e){var f=a(e).parents(b.field.selector);d.push(f)}),d},openWorkflowConfig:function(){var c=a(b.getTemplate("workflow-config"));c.find("[data-workflow-config-title]").val(b.titleInput().val()),c.find("[data-workflow-config-description]").val(b.descInput().val()),b.fieldSettings().html(c.wrap("<p/>").parent().html()),c.unwrap()},"{workflowConfigSave} click":function(c){var e=c.parents("[data-config-dialog]"),f=e.find("[data-workflow-config-title]").val(),g=e.find("[data-workflow-config-description]").val();b.titleInput().val(f),b.descInput().val(g),a("[data-structure-heading]").html(f),a("[data-structure-description]").html(g),b.closeDialog()},"{newStep} click":function(){b.addStep()},"{step} click":function(a){var d=a.data("id");b.switchTab(d)},showFieldBrowser:function(){b.fieldBrowser().removeClass(c.hiddenClass),b.fieldBrowser().find("[data-message-group]").html("")},closeDialog:function(){b.fieldBrowser().addClass(c.hiddenClass),b.dialogError().addClass(c.hiddenClass),b.dialogFieldCancel().trigger("click")},showDialogError:function(d){var e=a(b.getTemplate("dialog-error")),f=e.find('[data-error-type="'+d+'"]');f.length>0?f.removeClass(c.hiddenClass):e.find('[data-error-type="default"]').removeClass(c.hiddenClass),b.fieldSettings().html(e.wrap("<p/>").parent().html()),e.unwrap()},getField:function(c){var d=a(b.field.selector+'[data-id="'+c+'"]');return d},updateFieldBrowser:function(a,d){var f=b.fieldBrowserItem().filter('[data-id="'+a+'"]'),g=f.parents(b.fieldTypeContent.selector);if("standard"!=g.attr("id")){f[d+"Class"](c.hiddenClass);var h=g.find(b.fieldBrowserItems.selector).children(),i=b.fieldsTypeTab().filter('[id="'+g.attr("id")+'"]');h.not("."+c.hiddenClass).length<1?(i.addClass(c.hiddenClass),b.fieldsTypeTab().not("."+c.hiddenClass).eq(0).trigger("click")):i.removeClass(c.hiddenClass)}},switchTab:function(a){var d=b.getStepTab(a),e=b.getStepContent(a);b.deselectFields(),b.step().removeClass("is-active"),d.addClass("is-active"),b.content().addClass(c.hiddenClass),e.removeClass(c.hiddenClass)},addStep:function(){var d=a.uid(),e=b.getTemplate("step");e.attr("data-id",d),e.insertBefore(b.newStep());var f=b.getTemplate("editor");f.attr("data-id",d),f.insertBefore(b.templates()),b.updateOrdering(b.step()),b.deleteStepButton().removeClass(c.hiddenClass),e.trigger("click")},addField:function(c,d,e){var f=!1;if(void 0==d){var d=b.getTemplate("field"),g=c.data("fieldElement");"header"==g&&d.addClass("es-wf-field--header"),d.attr("data-id",a.uid()),d.attr("data-appid",c.data("id")),d.attr("data-element",g),d.attr("data-unique",c.data("unique")),d.find("[data-field-item-title]").html(c.data("fieldTitle")),d.find("[data-field-item-element]").html(g.toUpperCase()),f=!0}if(void 0==e)var e=b.getCurrentStep();var h=e.find("[data-fields-wrapper]"),i=h.find("[data-fields]");if(i.children().length>0){var j=a(b.currentNewField).data("action")||"prepend";i[j](d)}else{var k=i.siblings("[data-form-actions]"),l=b.getTemplate("placeholder-before"),m=b.getTemplate("placeholder-after");k.length<=0&&i.before(l),i.append(d),k.length<=0&&i.after(m)}h.removeClass("is-empty"),b.updateOrdering(i.children()),b.initFieldsSortable(),f&&(b.setMessage(!1,"info",b.fieldBrowser()),b.updateFieldBrowser(c.data("id"),"add")),a.scrollTo(d.offset().top-250,200),d.addClass("is-new"),setTimeout(function(){d.removeClass("is-new")},1500)},hideBatchActions:function(){b.batchActions().addClass("t-hidden")},showBatchActions:function(){b.batchActions().removeClass("t-hidden")},updateBatchActions:function(){var a=b.getSelectedFields();return a.length>0?(b.showBatchActions(),void 0):(b.hideBatchActions(),void 0)},showDeleteDialog:function(c){var d=b.getTemplate("dialog-delete-field");b.fieldSettings().html(d.wrap("<p/>").parent().html()),d.unwrap();var e=b.fieldSettings().find("[data-dialog-deletefield]");e.on("click",function(){a.each(c,function(c){var c=a(this),e=c.data("id");b.removeField(e)}),b.updateBatchActions(),b.closeDialog()})},showMoveDialog:function(d){var e=b.getTemplate("dialog-move-field"),f=b.step(),g=e.find("[data-move-selection]");f.length>1?(a.each(f,function(){var d=a(this).data("id");if(d){var e='<option value="'+d+'">'+a(this).find("[data-step-title]").html()+"</option>";g.append(e)}}),e.find("[data-field-available]").removeClass(c.hiddenClass)):e.find("[data-field-unavailable]").removeClass(c.hiddenClass),b.fieldSettings().html(e.wrap("<p/>").parent().html()),e.unwrap();var h=b.fieldSettings().find("[data-dialog-move]");h.on("click",function(){var c=a(this).parents("[data-dialog-move-field]"),e=c.find("[data-move-selection]").val(),f=b.getStepContent(e);a.each(d,function(c){var c=a(this),e=c.data("id"),g=c.clone();b.removeField(e,!0),b.currentNewField='[data-field-new][data-action="before"]',g.find(b.checkbox.selector).checked(!1),b.addField(!1,g,f)}),b.getStepTab(e).trigger("click"),b.updateBatchActions(),b.closeDialog()})},"{batchMove} click":function(){var d=b.getSelectedFields();b.showMoveDialog(d)},"{batchDelete} click":function(){var d=b.getSelectedFields();b.showDeleteDialog(d)},"{fieldBrowserItem} click":function(a){b.addField(a)},"{fieldBrowser} click":function(a,c){c.target==a[0]&&(c.preventDefault(),c.stopPropagation(),b.closeDialog())},"{dialogError} click":function(a,c){c.target==a[0]&&(c.preventDefault(),c.stopPropagation(),b.closeDialog())},"{dialogErrorClose} click":function(a,c){c.preventDefault(),c.stopPropagation(),b.closeDialog()},"{newField} click":function(a){b.currentNewField=a,b.showFieldBrowser()},"{fieldBrowserClose} click":function(a,c){c.preventDefault(),c.stopPropagation(),b.closeDialog()},"{fieldsTypeTab} click":function(d){b.fieldsTypeTab().removeClass("active"),d.addClass("active");var f=d.attr("id"),g=b.fieldTypeContent();g.addClass(c.hiddenClass),g.each(function(){a(this).attr("id")==f&&a(this).removeClass(c.hiddenClass)})},"{editStep} click":function(c){b.fieldSettings().html(b.getTemplate("dialog-loader"));var e=c.parents(b.content.selector).data("id");b.fieldsData=[],EasySocial.ajax("admin/views/fields/loadStepConfiguration",{id:e}).done(function(c,d,f){b.stepsHtml&&a.each(b.stepsHtml,function(a,b){return b.stepId==e?(c=b.html,!1):void 0}),b.fieldSettings().html(c),b.fieldSettings().find("[data-fields-config-param-choices]").addController("EasySocial.Controller.Config.Choices"),a(b.fieldParam.selector).on("change",function(){b.paramChanged(a(this),f)}),a(b.fieldParam.selector).on("keyup",function(){b.paramChanged(a(this),f)})})},"{dialogFieldCancel} click":function(a,c){c.preventDefault(),c.stopPropagation(),b.fieldSettings().html("")},storeFields:function(a,c,d){b.storeFieldsData(a,d)},storeSteps:function(a,c){b.storeStepsData(a,c)},deleteFields:function(a){c.fieldsValue[a]&&b.storeFieldsData(a)},deleteStep:function(d){var e=a(b.step.selector+"[data-id="+d+"]");if(e.prev().length>0)var f=e.prev();else var f=e.next();var g=b.getStepContent(d);a.each(g.find(b.field.selector),function(c,d){b.updateFieldBrowser(a(d).data("appid"),"remove")}),void 0===b.deletedSteps&&(b.deletedSteps=[]),e.data("isnew")===!1&&b.deletedSteps.push(d),g.remove(),e.remove(),b.steps().children(b.step.selector).length<2&&b.deleteStepButton().addClass(c.hiddenClass),delete c.stepsValue[d],f.trigger("click"),b.isChanged()},storeFieldsData:function(a,b){c.fieldsValue[a]=b},storeStepsData:function(a,b){c.stepsValue[a]=b},getCurrentStep:function(){return b.content().not("."+c.hiddenClass)},getStepTab:function(c){return a(b.step.selector+'[data-id="'+c+'"]')},getStepContent:function(b){return a("[data-content][data-id="+b+"]")},injectSaveData:function(a){b.saveFieldsInput().val(""),a&&(a=JSON.stringify(a),b.saveFieldsInput().val(a))},updateFieldTitle:function(a,c){if(c){var d=b.getField(a),e=d.find("[data-field-item-title]"),f=function(a){e.html(a)};e.addClass("is-loading");var g=this.translateString(c);g.done(function(a){f(a)}).fail(function(){f(c)}).always(function(){e.removeClass("is-loading")})}},translateString:function(a){var b=EasySocial.ajax("admin/views/fields/getTranslation",{text:a});return b},updateFieldRequired:function(a,d){var e=b.getField(a),f=e.find(b.fieldRequiredSymbol.selector);e.attr("data-required",d),"1"==d?f.removeClass(c.hiddenClass):f.addClass(c.hiddenClass)},updateConditionsUI:function(d,e){var f=a(b.field.selector+'[data-id="'+d+'"]');return e&&void 0!=e?(f.find("[data-field-item-conditional]").removeClass(c.hiddenClass),f.addClass("has-condition"),void 0):(f.find("[data-field-item-conditional]").addClass(c.hiddenClass),f.removeClass("has-condition"),void 0)},updateStepHeader:function(c,d,e){if(d||e){var f=a(b.step.selector+'[data-id="'+c+'"]'),g=a(b.content.selector+'[data-id="'+c+'"]');d&&(f.find("[data-step-title]").html(d),g.find("[data-step-title]").html(d)),e&&g.find("[data-step-description]").html(e)}},"{dialogStepSave} click":function(c){var e=c.parents("[data-field-dialog]"),f=e.data("id"),g=[],h=!1,i=!1;b.fieldsData&&a.each(b.fieldsData,function(a,b){var c={name:b.name,value:b.value};"title"==b.name&&(h=b.value),"description"==b.name&&(i=b.value),g.push(c)});var j={stepId:f,html:e.wrap("<p/>").parent().html()},k=b.stepsHtml;b.stepsHtml=[],k&&a.each(k,function(a,c){c.stepId!=f&&b.stepsHtml.push({stepId:c.stepId,html:c.html})}),b.storeSteps(f,g),b.stepsHtml.push(j),b.updateStepHeader(f,h,i),b.closeDialog(),b.isChanged()},"{dialogFieldSave} click":function(d){var f=d.parents("[data-field-dialog]"),g=f.data("id"),i=(f.data("appid"),b.getCurrentStep().data("id")),j=f.find("[data-field-is-conditional]").is(":checked"),l=[],m=!1,n=[],o=b.getField(g).data("required");b.fieldsData&&a.each(b.fieldsData,function(a,b){var c={name:b.name,value:b.value};"title"==b.name&&(b.value?m=b.value:c=!1),"required"==b.name&&(o=b.value),c&&(l.push(c),n[b.name]=!0)});({fieldId:g,html:f.wrap("<p/>").parent().html()});if(b.fieldsChoices){var q=[];a.each(b.fieldsChoices,function(a,b){var c={value:b.value};q.push({items:c})}),l.push({choices:q}),n.choices=!0}if(j||(b.fieldsConditions=[],l.push({conditions:!1})),b.fieldsConditions){a.each(b.fieldsConditions,function(a,b){var c={value:b.value};l.push({conditions:c}),n.conditions=!0})}c.fieldsValue[g]&&a.each(c.fieldsValue[g],function(a,b){void 0===b.name||n[b.name]||l.push({name:b.name,value:b.value}),b.choices&&!n.choices&&l.push({choices:b.choices}),b.conditions&&!n.conditions&&l.push({conditions:b.conditions})}),b.storeFields(g,i,l),b.updateFieldTitle(g,m),b.updateFieldRequired(g,o),b.updateConditionsUI(g,j),b.closeDialog(),b.isChanged()},"{dialogFieldTab} click":function(a){var e=a.data("id");b.dialogFieldTab().removeClass("active"),a.addClass("active"),b.dialogFieldContent().addClass(c.hiddenClass),b.dialogFieldContent().filter('[data-id="'+e+'"]').removeClass(c.hiddenClass)},"{deleteStepButton} click":function(a){var d=a.parents(b.content.selector),e=d.data("id");if(b.isStepEmpty(e))return b.deleteStep(e),!0;var f=b.getTemplate("dialog-delete-step");b.fieldSettings().html(f.wrap("<p/>").parent().html()),f.unwrap();var g=b.fieldSettings().find("[data-dialog-confirm]");g.on("click",function(){b.deleteStep(e),b.closeDialog()})},"{checkbox} change":function(){b.updateBatchActions()},"{editField} click":function(d){var f=d.parents(b.field.selector),g=f.data("appid"),h=f.data("id"),i=c.fieldsValue[h],j=b.getAvailableFields(),k=[];b.fieldsData=[],b.fieldsConditions=[],b.fieldsChoices=[],b.fieldSettings().html(b.getTemplate("dialog-loader")),EasySocial.ajax("admin/views/fields/loadFieldConfiguration",{appId:g,fieldId:h,previousData:i,availableFields:j}).done(function(c,d,e){a.each(e,function(b,c){a.each(c.fields,function(b,c){c.subfields?a.each(c.subfields,function(a,c){k[b+"_"+a]=c}):k[b]=c})}),b.fieldSettings().html(c),b.fieldSettings().find("[data-fields-config-param-choices]").addController("EasySocial.Controller.Config.Choices"),a(b.fieldParam.selector).on("change",function(){b.paramChanged(a(this),k)}),a(b.fieldParam.selector).on("keyup",function(){b.paramChanged(a(this),k)}),b.fieldSettings().find("[data-field-is-conditional]").on("change",function(){b.toggleConditional(a(this))}),a(b.conditionalParam.selector).on("keyup",function(){b.conditionalChanged(a(this),k)}),a(b.conditionalParam.selector).on("change",function(){b.conditionalChanged(a(this),k)}),a(b.fieldParam.selector).trigger("change")})},toggleConditional:function(a){var d=a.is(":checked"),e=b.fieldSettings().find('[data-field-tab][data-id="conditional-rule"]'),f=b.fieldSettings().find('[data-field-content][data-id="conditional-rule"]');d?e.removeClass(c.hiddenClass):(e.addClass(c.hiddenClass),f.addClass(c.hiddenClass),b.fieldSettings().find("[data-field-tab]").first().trigger("click"))},conditionalChanged:function(c){var d=c.data("name"),e=c.parents("[data-field-dialog]"),f=b.getConditionsValue(d,e),g={name:d,value:f},h=b.fieldsConditions;b.fieldsConditions=[],h&&a.each(h,function(a,c){return c.name==d?!0:(b.fieldsConditions.push({name:c.name,value:c.value}),void 0)}),b.fieldsConditions.push(g)},paramChanged:function(c,d){var e=c.data("name"),f=c.parents("[data-field-dialog]"),g=b.getConfigValue(e,d,f),h=d[e];if("boolean"===h.type&&(g=c.is(":checked")?"1":"0"),"choices"==h.type)return b.onChoicesChanged(c,d);var i={name:e,value:g},j=b.fieldsData;b.fieldsData=[],j&&a.each(j,function(a,c){return c.name==e?!0:(b.fieldsData.push({name:c.name,value:c.value}),void 0)}),b.fieldsData.push(i)},getConditionsValue:function(c,d){var e=d.find(b.conditionalParam.selector).filterBy("name",c);return 0===e.length?void 0:(values=[],a.each(e.find("li"),function(b,c){c=a(c);var d=c.find("[data-fields-condition-param-choice-field]"),e=c.find("[data-fields-condition-param-choice-operator]"),f=c.find("[data-fields-condition-param-choice-value]");values.push({id:c.data("id"),field:d.val(),operator:e.val(),value:f.val()}),d.attr("value",d.val()),e.attr("value",e.val()),f.attr("value",f.val())}),values)},getConfigValue:function(c,d,e){var f=d[c],g=e.find(b.fieldParam.selector).filterBy("name",c);if(0===g.length)return void 0;var h="";switch(f.type){case"choices":h=[],a.each(g.find("li"),function(b,c){c=a(c);var d=c.find("[data-fields-config-param-choice-title]"),e=c.find("[data-fields-config-param-choice-value]"),f=c.find("[data-fields-config-param-choice-default]");h.push({id:c.data("id"),title:d.val(),value:e.val(),"default":f.val()}),d.attr("value",d.val()),e.attr("value",e.val()),f.attr("value",f.val())});break;case"boolean":h=g.is(":checked")?1:0,g.attr("value",h);break;case"checkbox":h=[],a.each(f.option,function(a,b){var c=g.filter("[data-fields-config-param-option-"+b.value+"]");c.length>0&&c.is(":checked")?(h.push(b.value),c.attr("checked","checked")):c.removeAttr("checked")});break;case"list":case"select":case"dropdown":h=g.length>0?g.val():f["default"]||"",g.find("option").prop("selected",!1),g.find('option[value="'+h+'"]').prop("selected",!0);break;case"input":case"text":default:h=g.length>0?g.val():f["default"]||"",g.attr("value",h)}return h},onChoicesChanged:function(c,d){var e=c.data("name"),f=c.parents("[data-field-dialog]"),g=b.getConfigValue(e,d,f),i=(d[e],{name:e,value:g}),j=b.fieldsChoices;b.fieldsChoices=[],j&&a.each(j,function(a,c){return c.name==e?!0:(b.fieldsChoices.push({name:c.name,value:c.value}),void 0)}),b.fieldsChoices.push(i)},"{moveField} click":function(a){var d=[a.parents(b.field.selector)];b.showMoveDialog(d)},"{deleteField} click":function(a){var d=[a.parents(b.field.selector)];b.showDeleteDialog(d)},removeField:function(a,c){var d=b.getField(a),e=d.parent(),f=e.parent();d.remove(),e.children().length<=0?(f.addClass("is-empty"),e.html("")):b.updateOrdering(e.children()),c&&void 0!=c||(void 0===b.deletedFields&&(b.deletedFields=[]),d.data("isnew")===!1&&b.deletedFields.push(a),b.deleteFields(a,b.getCurrentStep().data("id")),b.updateFieldBrowser(d.data("appid"),"remove"))}}}),b.resolve()})});
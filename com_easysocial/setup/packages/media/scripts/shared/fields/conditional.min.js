EasySocial.module("shared/fields/conditional",function(a){var b=this,c=a.isController("EasySocial.Controller.Field.Conditional");c||(EasySocial.Controller("Field.Conditional",{defaultOptions:{id:null,fieldTargeted:[],operator:[],conditionValue:[],result:[],multiListField:["multidropdown","multilist","multitextbox"]}},function(b,c,d){return{init:function(){c.id=d.data("id");var a=d.data("isconditional");a&&b.bindTargetedFields()},bindTargetedFields:function(){var e=d.data("conditions");e&&a.each(e,function(a,d){c.fieldTargeted.push(d.fieldId),c.operator.push(d.operator),c.conditionValue.push(d.value),b.formatConditionsValue(a),b.bindFields(a)})},bindFields:function(a){var c=b.getTargetedField(a);b.isAutocomplete(a)?b.bindAutocompleteFields(a):(c.on("change",function(){b.fieldChanged(a)}),c.on("keyup",function(){b.fieldChanged(a)}),c.on("onFieldShow",function(){b.fieldChanged(a)}),c.hasClass("t-hidden")||b.fieldChanged(a)),c.on("onFieldHide",function(){b.hideSelf(a)})},bindAutocompleteFields:function(c){var d=b.getTargetedField(c),e=d.find("[data-field-suggest]"),f=[],g=d.data("name"),h=d.find(':input[name="'+g+'[]"]');h.length>0&&a.each(h,function(b,c){var d=a(c).val();f.push(d)}),e.on("addItem",function(a,d){f.push(d.value),b.fieldChanged(c,f)}),e.on("removeItem",function(d,e){f.splice(a.inArray(e.value,f),1),b.fieldChanged(c,f)}),d.hasClass("t-hidden")||b.fieldChanged(c,f),d.on("onFieldShow",function(){b.fieldChanged(c,f)})},getRequiredChecking:function(){var b=a("[data-conditional-check]").val();return b?JSON.parse(b):!1},fieldChanged:function(e,f){if(!f)var f=b.getTargetedFieldValue(e);c.result[e]=b.checkCondition(f,e);var g=d.data("conditionsLogic");if(c.result){var h=!0;a.each(c.result,function(a,b){return"or"==g&&1==b?(h=!0,!1):(0==b&&(h=!1),void 0)}),h?b.showSelf():b.hideSelf()}},checkCondition:function(d,e){var f=c.conditionValue[e],g=!1;switch(d=b.formatValue(d,e),c.operator[e]){case"equal":b.isAutocomplete(e)?a.each(d,function(a,b){return b==f?(g=!0,!0):void 0}):d==f&&(g=!0);break;case"not equal":b.isAutocomplete(e)?d.length>0&&(g=!0,a.each(d,function(a,b){return b==f?(g=!1,!0):void 0})):d!=f&&(g=!0);break;case"contain":b.isAutocomplete(e)?a.each(d,function(a,b){g=new RegExp("\\b"+f+"\\b","i").test(b)}):g=new RegExp("\\b"+f+"\\b","i").test(d)}return g},getTargetedFieldValue:function(d){var e=b.getTargetedField(d),f=b.getTargetedFieldElement(d),g=e.find(":input"),h=[],i=!1;return g.length>0&&a.each(g,function(){var b=a(this),d="INPUT"==b[0].tagName?b[0].type.toLowerCase():b[0].tagName.toLowerCase();if("hidden"!=d)switch(d){case"radio":radio=b.is(":checked")?1:0,radio&&(h=b.val());break;case"checkbox":checkbox=b.is(":checked"),checkbox&&h.push(b.val());break;case"button":var e=b.parent(),g=e.find("input");"hidden"==g.attr("type")&&(h=g.val());break;case"select":case"text":b.val()&&(-1!==a.inArray(f,c.multiListField)?h.push(b.val()):h=b.val());break;default:b.val()&&(h=b.val())}}),a.isArray(h)?a.each(h,function(a,b){i=i?i+" "+b:b}):i=h,i},showSelf:function(){d.removeClass("t-hidden"),d.trigger("onFieldShow"),b.updateRequiredChecking(!0)},hideSelf:function(){d.addClass("t-hidden"),d.trigger("onFieldHide"),b.updateRequiredChecking(!1)},updateRequiredChecking:function(d){var e=b.getRequiredChecking();e&&(e[c.id]=d,e=JSON.stringify(e),a("[data-conditional-check]").val(e))},isAutocomplete:function(a){return"autocomplete"==b.getTargetedFieldElement(a)?!0:!1},getTargetedField:function(b){var d=a('[data-field-item][data-id="'+c.fieldTargeted[b]+'"]');return d},getTargetedFieldElement:function(a){var c=b.getTargetedField(a);return c.data("fieldItem")},formatValue:function(c,d){var e=b.getTargetedFieldElement(d),f=["1","2","3"];return"gender"==e&&c&&a.inArray(c,f)>=0&&(c="1"==c?"male":"3"==c?"other":"female"),c},formatConditionsValue:function(a){var d=b.getTargetedFieldElement(a);"gender"==d&&("1"==c.conditionValue[a]&&(c.conditionValue[a]="male"),"2"==c.conditionValue[a]&&(c.conditionValue[a]="female"),"3"==c.conditionValue[a]&&(c.conditionValue[a]="other"))}}}),b.resolve())});
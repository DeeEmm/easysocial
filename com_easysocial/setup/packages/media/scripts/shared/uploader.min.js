EasySocial.module("shared/uploader",function(a){var b=this;EasySocial.require().library("plupload").script("shared/uploader.item").done(function(){EasySocial.Controller("Albums.Uploader",{defaultOptions:{photoOrder:"newest",direction:"prepend","{uploadButton}":"[data-upload-button]","{uploadItemGroup}":"[data-upload-item-group]","{uploadItem}":"[data-upload-item]","{uploadDropsite}":"[data-upload-dropsite]"}},function(b,c,d){return{init:function(){b.getUploadItemTemplate();var d=b.element;b.pluploadController=b.element.addController("plupload",a.extend({"{uploadButton}":b.uploadButton.selector,"{uploadDropsite}":b.uploadDropsite.selector},c.settings)),b.plupload=b.pluploadController.plupload,a.IE||"html5"!=b.plupload.runtime||d.addClass("can-drop-file"),d.addClass("can-upload")},getUploadItemTemplate:function(){var d=b.element.find("[data-uploader-template]");c.uploadTemplate=a(d.html()).clone()},setLayout:function(){b.uploadItemGroup().toggleClass("no-upload-items",b.uploadItem().length<1)},items:{},getItem:function(c){var d;return a.isString(c)&&(d=c),c&&c.id&&(d=c.id),b.items[d]},createItem:function(a){var e=c.uploadTemplate.clone();e.attr("data-photo-upload-item","1"),e.attr("id",a.id),e.removeClass("t-hidden");var f=e.switchClass("layout-"+(d.data("albumLayout")||"form")).addController("EasySocial.Controller.Albums.Uploader.Item",{"{uploader}":b,file:a});return f.element["append"==c.direction?"appendTo":"prependTo"](b.uploadItemGroup()),b.items[a.id]=f,b.setLayout(),b.trigger("QueueCreated",[f]),f},settings:function(a,c){var d=b.plupload.settings;return void 0!==c&&(d[a]=c),a?d[a]:d},start:function(){return b.plupload.start()},stop:function(){return b.plupload.stop()},"{self} FilesAdded":function(c,d,e,f){try{a.each(f,function(a,c){b.getItem(c)||b.createItem(c)})}catch(g){console.error(g)}},"{self} BeforeUpload":function(a,c,d,e){var f=b.getItem(e);f&&f.setState("preparing")},"{self} UploadFile":function(a,c,d,e){var f=b.getItem(e);f&&f.setState("uploading")},"{self} UploadProgress":function(a,c,d,e){var f=b.getItem(e);f&&(f.setState("uploading"),f.setProgress())},"{self} FileUploaded":function(c,d,e,f,g){var h=b.getItem(f);if(h)return a.isPlainObject(g)?(h.setState("done"),void 0):(h.setState("failed"),void 0)},"{self} FileError":function(a,c,d,e,f){var g=b.getItem(e);g||(g=b.createItem(e)),g.setState("failed"),g.setMessage(f.message)},"{self} Error":function(a,c,d,e){if(e.file){var f=e.file,g=b.getItem(f);g||(g=b.createItem(f)),g.setState("failed"),g.setMessage(e.message)}},removeItem:function(a){var c=b.getItem(a);c&&(b.plupload.removeFile(c.file()),c.element.remove(),delete b.items[a],b.setLayout())},clear:function(){a.each(b.items,function(a,c){b.plupload.removeFile(c.file()),c.element.remove(),delete b.items[a]}),b.items={}}}}),b.resolve()})});
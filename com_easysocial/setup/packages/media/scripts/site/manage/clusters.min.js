EasySocial.module("site/manage/clusters",function(a){var b=this;EasySocial.Controller("Clusters",{defaultOptions:{"{activeButton}":"[data-active-filter-button]","{activeText}":"[data-active-filter-text]","{filter}":"[data-filter-item]","{filterText}":"[data-filter-item-text]","{wrapper}":"[data-wrapper]","{contents}":"[data-contents]","{items}":"[data-items]","{item}":"[data-item]","{pagination}":"[data-pagination]","{approve}":"[data-approve]","{reject}":"[data-reject]","{counters}":"[data-counter]"}},function(b){return{init:function(){b.initDefaultFilter()},initDefaultFilter:function(){var a=b.filter(".active");b.setActiveFilter(a)},updateCounter:function(){EasySocial.ajax("site/controllers/manage/getClusterCounters").done(function(a){b.filter('[data-type="event"]').find(b.counters.selector).html(a.event),b.filter('[data-type="group"]').find(b.counters.selector).html(a.group),b.filter('[data-type="page"]').find(b.counters.selector).html(a.page)})},removeItem:function(a){var c=b.item('[data-id="'+a+'"]');c.remove(),b.item().length<=0&&(b.items().addClass("is-empty"),b.pagination().remove()),b.updateCounter()},updateContents:function(c){b.contents().html(c),a("body").trigger("afterUpdatingContents",[c])},setActiveFilter:function(a){var c=a.find(b.filterText.selector).clone();b.activeText().html(c),b.activeButton().removeClass("is-loading"),b.filter().removeClass("active"),a.addClass("active")},"{filter} click":function(a,c){c.preventDefault(),c.stopPropagation();var d=a.data("type");b.setActiveFilter(a);var e=a.find("> a");e.route(),b.wrapper().addClass("is-loading"),b.contents().empty(),b.activeButton().click(),EasySocial.ajax("site/controllers/manage/filterCluster",{filter:d}).done(function(a){b.updateContents(a)}).always(function(){b.wrapper().removeClass("is-loading"),a.removeClass("is-loading")})},"{approve} click":function(a){var d=a.closest(b.item.selector).data("id"),e=a.closest(b.item.selector).data("type");EasySocial.dialog({content:EasySocial.ajax("site/views/manage/confirmClusterApprove",{clusterId:d,clusterType:e}),selectors:{"{sendMail}":"[data-send-email]","{approveButton}":"[data-approve-button]","{cancelButton}":"[data-cancel-button]"},bindings:{"{approveButton} click":function(){var a=this.sendMail().is(":checked")?1:0;EasySocial.ajax("site/controllers/manage/approveCluster",{clusterId:d,clusterType:e,sendMail:a}).done(function(){b.removeItem(d),EasySocial.dialog().close()})},"{cancelButton} click":function(){EasySocial.dialog().close()}}})},"{reject} click":function(a){var d=a.closest(b.item.selector).data("id"),e=a.closest(b.item.selector).data("type");EasySocial.dialog({content:EasySocial.ajax("site/views/manage/confirmClusterReject",{clusterId:d,clusterType:e}),selectors:{"{rejectMessage}":"[data-reject-message]","{rejectButton}":"[data-reject-button]","{cancelButton}":"[data-cancel-button]","{sendMail}":"[data-send-email]","{deleteCluster}":"[data-delete-cluster]"},bindings:{"{rejectButton} click":function(){var a=this.rejectMessage().val(),c=this.sendMail().is(":checked")?1:0,f=this.deleteCluster().is(":checked")?1:0;EasySocial.ajax("site/controllers/manage/rejectCluster",{clusterId:d,clusterType:e,rejectMessage:a,sendMail:c,deleteCluster:f}).done(function(){b.removeItem(d),EasySocial.dialog().close()})},"{cancelButton} click":function(){EasySocial.dialog().close()}}})}}}),b.resolve()});
EasySocial.module("site/story/mood",function(a){var b=this;EasySocial.require().done(function(){EasySocial.Controller("Story.Mood",{defaultOptions:{"{base}":"[data-story-mood]","{presets}":"[data-story-mood-presets]","{preset}":"[data-story-mood-preset]","{verb}":"[data-story-mood-verb]","{verbType}":"[data-story-mood-verb-type]","{textField}":"[data-story-mood-textfield]","{removeButton}":"[data-story-mood-remove-button]"}},function(b){return{init:function(){var a=b.options.currentMood;b.reset(),a&&(b.textField().val(a.subjectText).focus(),b.setMood(a))},setLayout:function(){var a=b.base(),c=b.textField();a.toggleClass("is-empty",""===c.val())},currentMood:{},resetMood:function(){b.currentMood={icon:"",verb:"",subject:"",text:"",custom:!1},b.preset().removeClass("is-disabled"),b.story.setMeta("mood","")},setMood:function(c,d){var e=b.currentMood;a.isPlainObject(c)?a.extend(e,c):e[c]=d,b.base().toggleClass("using-preset",!e.custom),b.updateMeta(),b.setLayout()},getVerb:function(){return b.verbType(".active").data("storyMoodVerbType")||"feeling"},reset:function(){b.selecting=!0,b.resetMood(),b.preset().removeClass("is-disabled"),b.textField().val("").focus(),b.setLayout(),b.base().removeClass("using-preset hide-preset"),b.selecting=!1},updateMeta:function(){var a=b.currentMood,c=a.icon?'<i class="es-emoji '+a.icon+'"></i> ':"";b.verbType().removeClass("active").filterBy("storyMoodVerbType",a.verb).addClass("active"),b.story.setMeta("mood",c+a.text)},"{preset} click":function(a){var c={icon:a.data("storyMoodIcon"),verb:a.data("storyMoodVerb"),subject:a.data("storyMoodSubject"),text:a.data("storyMoodText"),subjectText:a.data("storyMoodSubjectText"),custom:!1};b.selecting=!0,b.textField().val(c.subjectText).focus(),b.setMood(c),b.selecting=!1},"{textField} keydown":function(){b.update()},"{textField} keyup":function(){b.update()},"{textField} input":function(c){if(!b.selecting){var e=c.val();if(!e)return b.reset(),void 0;var f=b.currentMood,g=!f.custom&&e!==f.subjectText;g&&b.setMood("custom",!0);var h=b.preset().filter(function(){var b=a(this),c=0!==b.data("storyMoodSubjectText").indexOf(e);return b.toggleClass("is-disabled",c),!c});b.base().toggleClass("hide-preset",h.length<1);var i=b.getVerb(),j={verb:i,subject:"",custom:!0,text:b.story.options.moodText+" "+e};b.setMood(j)}},"{removeButton} click":function(){b.reset()},"{story} activateMeta":function(a,c,d){"mood"===d.name&&setTimeout(function(){b.textField().focus()},1)},"{story} save":function(a,c,d){var e=b.currentMood;e.verb&&(d.data.mood_icon=e.icon,d.data.mood_verb=e.verb,d.data.mood_subject=e.subject,d.data.mood_custom=e.custom,d.data.mood_text=e.text)},"{story} clear":function(){b.reset()}}}),b.resolve()})});
EasySocial.module("site/story/story",function(a){var b=this,c=EasySocial.options.momentLang,d=window.es.requireGmaps?"site/story/gmaps":"site/story/osm";EasySocial.require().script("site/story/friends","site/story/mood",d),EasySocial.require().library("mentions","datetimepicker","moment/"+c).done(function(){EasySocial.Controller("Story",{hostname:"story",defaultOptions:{plugin:{text:{id:"text",name:"text",selector:"[data-story-plugin-name=photos]",type:"panel"}},sourceView:null,attachment:{limit:1,lifo:!0},flood:{enabled:!1,interval:90,submit:!0},enterToSubmit:!1,hashtagEditable:!1,singlePanel:!1,emoticons:[],"{body}":"[data-body]","{footer}":"[data-footer]","{form}":"[data-story-form]","{textbox}":"[data-story-textbox]","{textField}":"[data-story-textField]","{target}":"[data-story-target]","{cluster}":"[data-story-cluster]","{clusterType}":"[data-story-clustertype]","{clusterPrivacy}":"[data-story-clusterprivacy]","{anywhereId}":"[data-story-anywhere]","{submitButton}":"[data-story-submit]","{privacyButton}":"[data-story-privacy]","{postAsButton}":"[data-postas-toggle]","{panelContents}":"[data-story-panel-contents]","{panelContent}":"[data-story-panel-content]","{panelButton}":"[data-story-panel-button]","{friends}":"[data-story-friends]","{location}":"[data-story-location]","{mood}":"[data-story-mood]","{autopost}":"[data-story-autopost]","{background}":"[data-background-select]","{currentBackground}":"[data-background-current]","{resetBackground}":"[data-background-reset]","{params}":"[data-story-params]","{scheduled}":"[data-story-scheduled]","{mentionsOverlay}":"[data-mentions-overlay]","{mentionsMetaOverlay}":"[data-mentions-meta-overlay]","{resetButton}":"[data-story-reset]","{giphyBrowser}":"[data-giphy-browser]","{giphyWrapper}":"[data-story-giphy]","{giphyPlaceholder}":"[data-giphy-placeholder]","{giphyPreview}":"[data-giphy-preview]","{giphyRemove}":"[data-giphy-remove]","{giphyForm}":"[data-giphy-browser]","{insertGiphy}":"[data-giphy-item]","{giphyLoader}":"[data-giphy-loader]","{giphyLoaderWrapper}":"[data-giphy-wrapper]","{giphyMetaContent}":"[data-story-meta-content=giphy]","{meta}":"[data-story-meta]","{metaContents}":"[data-story-meta-contents]","{metaContent}":"[data-story-meta-content]","{metaButtons}":"[data-story-meta-buttons]","{metaButton}":"[data-story-meta-button]","{tagHints}":"[data-hints-hashtags]","{friendHints}":"[data-hints-friends]","{emoticonHints}":"[data-hints-emoticons]","{plusButton}":"[data-story-panel-add]","{giphyButton}":"[data-story-giphy-meta-button]"}},function(b,c,d){return{init:function(){b.id=d.data("story"),b.streamId=d.data("stream-id"),b.isModule=d.data("story-module"),b.isEdit=!1,b.streamId&&(b.isEdit=b.streamId),b.isEdit?b.initMention():c.flood.enabled&&!c.flood.submit&&b.lockSubmitButton(c.flood.interval);var e="",f=0;if(a.each(b.options.plugin,function(a,c){var d=b.plugins[a]=c;"attachment"==d.type&&b.attachments.max++,d.selector=b.getPluginSelector(a),e=a,b.options.singlePanel&&"text"!=a&&f++}),!b.isEdit&&1!=f||"text"==e||b.activatePanel(e),b.setMentionsLayout(),b.friends().length>0){var g=b.cluster().val(),h=b.clusterType().val(),i=b.clusterPrivacy().val(),j={};(2==i||3==i)&&(namespace="site/controllers/friends/suggestClusterMembers",j={namespace:namespace,clusterId:g,clusterType:h}),EasySocial.module("site/story/friends").done(function(){if(b.addPlugin("friends",j),b.isEdit){var c=b.friends().find("[data-textboxlist-item]"),d=[];c.each(function(){var b=a(this).data("id");d.push(b)}),EasySocial.ajax("site/views/story/buildStoryMeta",{ids:d}).done(function(a){b.setMeta("friends",a)})}})}if(b.location().length>0){var k=!1,l=b.options.currentLocation,m=b.options.mapElementId;b.isEdit&&l&&(k=l),"osm"!==b.options.mapIntegration?EasySocial.module("site/story/gmaps").done(function(){b.addPlugin("gmaps",{currentLocation:k})}):EasySocial.module("site/story/osm").done(function(){b.addPlugin("osm",{currentLocation:k,mapElementId:m})})}if(b.options.currentGiphy&&(b.activateMeta("location")&&b.deactivateMeta("location"),b.activateMeta("giphy")),b.mood().length>0){var n=!1,o=b.options.currentMood;b.isEdit&&o&&(n=o),EasySocial.module("site/story/mood").done(function(){b.addPlugin("mood",{currentMood:n})})}b.scheduled().length>0&&b.scheduled().addController("EasySocial.Controller.Scheduled.DateTime",{"{parent}":b,scheduledPost:c.scheduledPost,dateFormat:b.scheduled().data("dateformat")}),b.placeholder=b.textField().attr("placeholder"),b._setMessage=b.setMessage,b.setMessage=function(){d.hasClass("is-resizing")||(this.element.find("[data-message-group]").remove(),b._setMessage.apply(this,arguments))},navigator.userAgent.match(/MSIE 9.0/i)&&d.addClass("is-ie"),a.module("story-"+b.id).resolve(b)},"{resetBackground} click":function(){var d=b.body().find(".es-story-text"),e=b.body().find("> .es-story-panel-content");b.background().removeClass("is-selected"),d.attr("class","es-story-text"),e.attr("class","es-story-panel-content"),b.currentBackground().attr("class","es-story-bg-menu-preview").data("id","")},"{background} click":function(a){var d=a.data("id"),e=b.body().find(".es-story-text"),f=b.body().find("> .es-story-panel-content");b.background().removeClass("is-selected"),a.addClass("is-selected"),e.attr("class","es-story-text es-story--bg-"+d),f.attr("class","es-story-panel-content es-story--bg-"+d),b.currentBackground().attr("class","es-story-bg-menu-preview es-story--bg-"+d).data("id",d)},giphyURL:null,"{insertGiphy} click":function(a){var c=a.data("original");b.insertGiphyUrl(c)},insertGiphyUrl:function(c){b.giphyPreview().attr("src",c),b.giphyLoader().removeClass("t-hidden"),b.giphyLoaderWrapper().addClass("is-loading"),b.giphyPlaceholder().css("width","100%"),b.giphyPreview().off("load").on("load",function(){b.giphyLoaderWrapper().removeClass("is-loading"),b.giphyLoaderWrapper().addClass("t-hidden"),b.giphyPlaceholder().removeClass("t-hidden"),b.giphyForm().addClass("t-hidden");var c=a(this).parent();setTimeout(function(){var a=c.css("width");b.giphyPlaceholder().css("width",a)},10)}),b.giphyURL=c},"{giphyRemove} click":function(){b.removeGiphy()},"{self} click":function(c,d){a(d.target).parents().andSelf().length>0||b.expand()},removeGiphy:function(){b.giphyURL="",b.giphyPlaceholder().addClass("t-hidden"),b.giphyPreview().attr("src",""),b.giphyForm().removeClass("t-hidden"),b.giphyLoaderWrapper().removeClass("t-hidden"),c.currentGiphy&&b.giphyWrapper().removeClass("t-hidden"),c.currentGiphy=null},"{textField} touchstart":function(){b.expand()},"{textField} keydown":function(){b.expand()},"{textField} click":function(a,d){b.expand(),c.hashtagEditable||b.preventHashtagEdit(a,d)},"{textField} dragstart":function(a,b){b.preventDefault()},"{textField} mousedown":function(){b.expand()},"{textField} keydown":function(a,d){((d.metaKey||d.ctrlKey)&&13==d.keyCode||c.enterToSubmit&&13==d.keyCode&&!(d.shiftKey||d.altKey||d.ctrlKey||d.metaKey))&&(b.save(),d.preventDefault()),c.hashtagEditable||b.preventHashtagEdit(a,d)},"{textField} paste":function(a,d){c.hashtagEditable||b.preventHashtagEdit(a,d)},"{textField} focus":function(a){b.setTextboxCaret(a)},setTextboxCaret:function(c){if(!b.isEdit){var d=a(c).data("default"),e=c.val();if(0!=d.length&&d.length==e.length){var f=b.textbox(),g=f.controller("mentions"),h=g.getMarkers(),i=null;if(a.each(h,function(){var a=this;a.length>=1&&(i=a)}),null!=i){var j=a(i.textarea),k=i.start+i.length,d=a(c).data("default"),e=c.val();j.caret(k)}}}},reset:function(){b.clear(),b.mentionsOverlay().css("height","0"),b.activatePanel("text")},hide:function(){b.reset(),d.removeClass("is-resizing").removeClass("is-expanded").addClass("is-collapsed")},"{resetButton} click":function(){b.hide()},expand:a.debounce(function(){if(!d.hasClass("is-expanded")&&!d.hasClass("is-resizing")){var c=a.support&&a.support.transition&&a.support.transition.end,e=(c||"transitionend")+".es.story",f=a.debounce(function(){d.off(e).addClass("is-expanded").removeClass("is-resizing"),b.setMentionsLayout(),b.submitButton().removeAttr("data-disabled"),b.textField().focus()},1);c?d.on(e,f):setTimeout(f,600),d.removeClass("is-collapsed").addClass("is-resizing")}},1),preventHashtagEdit:function(c,d){var e=a(c).data("default"),f=b.textbox(),g=f.controller("mentions"),h=g.getMarkers(),i=null;if(a.each(h,function(){var a=this;a.length>=1&&(i=a)}),null!=i){var j=a(i.textarea),k=j.caret().start;if(8==d.keyCode&&k==e.length&&d.preventDefault(),k<e.length){var l=i.start+i.length;j.caret(l),textValue=c.val(),endPos=j.caret().end,endPos==textValue.length?g.reset():d.preventDefault()}}51==d.keyCode&&d.shiftKey&&d.preventDefault()},collapse:function(){d.hasClass("is-collapsed")||d.hasClass("is-resizing")||(d.addClass("is-resizing").removeClass("is-expanded"),b.clear(),b.textField().blur(),setTimeout(function(){d.addClass("is-collapsed").removeClass("is-resizing")},1))},initMention:function(){var c=b.find("[data-story-textbox]"),d=c.controller("mentions");if(d)d.cloneLayout();else{var e=a("[data-hints-hashtags]"),f=a("[data-hints-friends]"),g=a("[data-hints-emoticons]"),h=a("[data-hints-autocomplete]");a.template("mentions/xsearchHint",h.find("[data-search]").html()),a.template("mentions/xemptyHint",h.find("[data-empty]").html()),c.mentions({triggers:{"@":{type:"entity",wrap:!1,stop:"",allowSpace:!0,finalize:!0,query:{loadingHint:!0,searchHint:f.find("[data-search]"),emptyHint:f.find("[data-empty]"),data:function(c){var d=a.Deferred(),e="site/controllers/friends/suggest",f={search:c},g=b.cluster().val();if(g){var h=b.clusterPrivacy().val();(2==h||3==h)&&(e="site/controllers/friends/suggestClusterMembers",f={search:c,clusterId:g,clusterType:b.clusterType().val()})}return EasySocial.ajax(e,f).done(function(b){a.isArray(b)||d.reject();var b=a.map(b,function(b){var c=a("<div/>").html(b),d=c.find("[data-suggest-title]").val(),e=c.find("[data-suggest-id]").val();return{id:e,title:d,type:"user",menuHtml:b}});d.resolve(b)}).fail(d.reject),d},use:function(a){return a.type+":"+a.id}}},"#":{type:"hashtag",wrap:!0,stop:" #!$%^&*,.+",allowSpace:!1,query:{loadingHint:!0,searchHint:e.find("[data-search]").html(),emptyHint:e.find("[data-empty]").html(),data:function(b){var c=a.Deferred();return EasySocial.ajax("site/controllers/hashtags/suggest",{search:b}).done(function(b){a.isArray(b)||c.reject();var b=a.map(b,function(a){return{title:"#"+a,type:"hashtag",menuHtml:a}});c.resolve(b)}).fail(c.reject),c}}},":":{type:"emoticon",wrap:!0,stop:"",allowSpace:!1,query:{loadingHint:!0,searchHint:g.find("[data-search]").html(),emptyHint:g.find("[data-empty]").html(),data:a.parseJSON(b.options.emoticons),renderAll:!0}}},plugin:{autocomplete:{id:"es",component:"es",modifier:"es-story-mentions-autocomplete",sticky:!0,shadow:!0,position:{my:"left top",at:"left bottom",of:b.find(".es-story-text"),collision:"none"},view:{searchHint:"mentions/xsearchHint",emptyHint:"mentions/xemptyHint"}}}})}},setMentionsLayout:function(){var c=b.textbox(),d=c.controller("mentions");if(d){var e=b.options.mentionedItems;if(b.isEdit&&e){var f=d.getMarkers();a.each(f,function(){var b=this;a.each(e,function(){var c=this;if(b.start==c.start&&b.length==c.length){var e=b.val(),f="user:"+c.userId,g=d.getTriggerFromType("entity");if("#"==e.charAt(0))var g=d.getTriggerFromType("hashtag"),f=e.substring(1);if(":"==e.charAt(0))var g=d.getTriggerFromType("emoticon"),f=e.substring(1);var h=a(b.block).data("marker");h.trigger=g,b.updateValue(f)}})})}return d.cloneLayout(),void 0}var g=b.body();c.mentions({triggers:{"@":{type:"entity",wrap:!1,stop:"",allowSpace:!0,finalize:!0,query:{loadingHint:!0,searchHint:b.friendHints().find("[data-search]").html(),emptyHint:b.friendHints().find("[data-empty]").html(),data:function(c){var d=a.Deferred(),e="site/controllers/friends/suggest",f={search:c},g=b.cluster().val();if(g){var h=b.clusterPrivacy().val();(2==h||3==h)&&(e="site/controllers/friends/suggestClusterMembers",f={search:c,clusterId:g,clusterType:b.clusterType().val()})}return EasySocial.ajax(e,f).done(function(b){if(!a.isArray(b))return d.reject(),void 0;var b=a.map(b,function(b){var c=a("<div/>").html(b),d=c.find("[data-suggest-title]").val(),e=c.find("[data-suggest-id]").val();return{id:e,title:d,type:"user",menuHtml:b}});d.resolve(b)}).fail(d.reject),d},use:function(a){return a.type+":"+a.id}}},"#":{type:"hashtag",wrap:!0,stop:" #!$%^&*,.+",allowSpace:!1,query:{loadingHint:!0,searchHint:b.tagHints().find("[data-search]").html(),emptyHint:b.tagHints().find("[data-empty]").html(),data:function(b){var c=a.Deferred();return EasySocial.ajax("site/controllers/hashtags/suggest",{search:b}).done(function(b){if(!a.isArray(b))return c.reject(),void 0;var b=a.map(b,function(b){return{title:"#"+a.trim(b),type:"hashtag",menuHtml:b}});c.resolve(b)}).fail(c.reject),c}}},":":{type:"emoticon",wrap:!0,stop:"",allowSpace:!1,query:{loadingHint:!0,searchHint:b.emoticonHints().find("[data-search]").html(),emptyHint:b.emoticonHints().find("[data-empty]").html(),data:a.parseJSON(b.options.emoticons),renderAll:!0}}},plugin:{autocomplete:{id:"es",component:"",modifier:"es-story-mentions-autocomplete",sticky:!0,shadow:!0,position:{my:"left top",at:"left bottom",of:c.parent(),collision:"none"},size:{width:function(){return g.width()}}}}})},plugins:{},getPluginName:function(b){return a(b).data("story-plugin-name")},getPluginSelector:function(a){return"[data-story-plugin-name="+a+"]"},hasPlugin:function(a,c){var d=b.plugins[a];return d?c?d.type===c:!0:!1},buildPluginSelectors:function(c,d,e){var f={};return a.each(c,function(a,c){var g=b[c].selector+d.selector;"function"==e?f[c]=function(){return b.find(g)}:f["{"+c+"}"]=g}),f},"{self} addPlugin":function(c,d,e,f,g,h){if(b.hasPlugin(e)){var i=b.plugins[e],j={};switch(i.type){case"panel":var k=["panelButton","panelContent"];j=b.buildPluginSelectors(k,i,h)}a.extend(g,j)}},"{self} registerPlugin":function(a,c,d,e){if(b.hasPlugin(d)){var f=b.plugins[d];f.instance=e}},panels:{},currentPanel:"text",getPanel:function(a){if(b.hasPlugin(a,"panel")){var c=b.plugins[a];return b.panels[c.name]||(b.panels[c.name]={plugin:c,button:b.panelButton(c.selector),content:b.panelContent(c.selector)})}},activatePanel:function(a){var c=b.getPanel(a);if(c){b.deactivatePanel(b.currentPanel),"text"!=a?(b.giphyButton().addClass("t-hidden"),b.deactivateMeta("giphy"),b.removeGiphy()):b.giphyButton().removeClass("t-hidden"),b.currentPanel=a;var e=b.panelContents();b.submitButton().removeAttr("disabled"),e.addClass("active"),c.button.addClass("active"),c.content.appendTo(e).addClass("active"),d.addClass("plugin-"+a),b.invokePlugin(a,"activatePanel",[c]),b.trigger("activatePanel",[a]),b.textField().focus()}},deactivatePanel:function(a){var c=b.getPanel(a);c&&(c.button.removeClass("active"),c.content.removeClass("active"),d.removeClass("plugin-"+a),b.panelContents().removeClass("active"),b.invokePlugin(a,"deactivatePanel",[c]),b.trigger("deactivatePanel",[a]))},addPanelCaption:function(a,c){var d=b.getPanel(a);d&&d.button.addClass("has-data").find(".with-data").html(c)},removePanelCaption:function(a){var c=b.getPanel(a);c&&c.button.removeClass("has-data").find(".with-data").empty()},"{panelButton} click":function(a){var d=b.getPluginName(a);b.activatePanel(d)},"{plusButton} click":function(){window.currentStoryController=b},saving:!1,locked:!1,save:function(d){if(!b.saving){if(b.locked)return EasySocial.dialog({content:EasySocial.ajax("site/views/story/showFloodWarning")}),void 0;b.saving=!0;var e=a.Deferred();e.data={},e.tasks=[],e.addData=function(c,d){{var f=c.options.name;c.options.type}f===b.currentPanel&&(e.data.attachment=b.currentPanel,a.isPlainObject(d)?a.each(d,function(a,b){e.data[f+"_"+a]=b}):e.data[f]=d)},e.addTask=function(b){var c=a.Deferred();return c.name=b,c.save=e,e.tasks.push(c),c},e.process=function(){return"pending"===e.state()&&a.when.apply(a,e.tasks).done(function(){if(!a.trim(e.data.content)&&!e.data.attachment&&!e.data.giphy)return e.reject(c.errors.empty,"warning"),void 0;var d=b.scheduled().find("#scheduled");if(e.data.scheduled=!1,d.length>0){if(a.isEmpty(a.trim(d.val())))return b.scheduled().addClass("has-error"),e.reject(c.errors.scheduled,"warning"),void 0;if(e.data.scheduled=d.val(),"broadcast"==e.data.attachment&&!a.isEmpty(e.data.broadcast_expirydate)&&e.data.broadcast_expirydate<e.data.scheduled)return e.reject(c.errors.invalidScheduled,"warning"),void 0}e.resolve()}).fail(e.reject),e},e.data.isEdit=d,e.data.giphy=b.giphyURL?b.giphyURL:b.options.currentGiphy,b.giphyURL&&b.removeGiphy(),e.currentPanel=b.currentPanel,b.trigger("save",[e]),b.element.addClass("is-loading"),e.process().done(function(){var f=b.textbox().mentions("controller").toArray(),g=b.element.data("storyHashtags"),h=!1;if(g=g?g.split(","):[],g.length>0){var i=a.map(f,function(b){return"hashtag"===b.type&&a.inArray(b.value,g)>-1?b:void 0});h=i.length<1}b.trigger("beforeSubmit",[e]),e.data.backgroundId=b.currentBackground().data("id");var j=b.autopost().find("input[type=checkbox]:checked");e.data.autopost=[],j.length>0&&j.each(function(b,c){var c=a(c),d=c.attr("name"),f=c.is(":checked");f&&(e.data[d]=1)});var k=b.params();k.length>0&&a.each(k,function(){var d=a(this).attr("name"),f=a(this).val();e.data[d]=f});var l=b.getStreamIdentifier();EasySocial.ajax("site/controllers/story/create",e.data).done(function(a,e,f,g,i,j,k,m,n){d?b.trigger("update",[a,e,g,i,j,k,m,n]):(h&&(a=b.setMessage(c.errors.filter)),b.trigger("create",[l,a,e]),b.clear(),c.flood.enabled&&b.lockSubmitButton(c.flood.interval)),b.isModule&&f&&b.setMessage(f.message,f.type),(window.es.mobile||window.es.tablet)&&window.es.initReactions(),b.clearSchedule()}).fail(function(c){b.trigger("fail",arguments);var d=c,e="warning";"string"!==a.type(c)&&(d=c.message,e=c.type),b.setMessage(d,e)}).always(function(){b.trigger("afterSubmit",[e]),b.element.removeClass("is-loading"),b.saving=!1})}).fail(function(a,d){a||(a=c.errors.standard,d="error"),b.setMessage(a,d),b.element.removeClass("is-loading"),b.saving=!1})}},lockSubmitButton:function(a){if(c.flood.enabled&&a>0){b.locked=!0;var d=1e3*a;setTimeout(function(){b.locked=!1},d)}},getStreamIdentifier:function(){var a=b.element.closest("[data-es-streams]").data("identifier");return void 0==a?"":a},clear:function(){b.textField().val(""),b.clearMessage(),b.options.singlePanel||b.activatePanel("text"),b.deactivateMeta(b.currentMeta),b.trigger("clear");var a=b.textbox().mentions("controller");a.reset(),setTimeout(function(){a.cloneLayout()},500),b.textField().focus(),b.resetBackground().click()},getPostActor:function(){var b=a("[data-postas-base] [data-postas-hidden]");return b.val()},"{self} save":function(c,d,e){var f=b.textField().val(),g=e.data;g.view=b.options.sourceView,g.content=f,g.target=b.target().val(),g.cluster=b.cluster().val(),g.clusterType=b.clusterType().val(),g.anywhereId=b.anywhereId().val(),g.pageTitle=window.document.title,g.postActor=b.getPostActor(),g.privacy=b.find("[data-privacy-hidden]").val(),g.privacyCustom=b.find("[data-privacy-custom-hidden]").val(),g.privacyField="";var h=[];if(b.find("[data-privacy-field-inputs]").each(function(b,c){var d=a(c),e=d.attr("name"),f=d.val();f&&(e=e+"|"+f.join(","),h.push(e))}),h){var i=h.join(";");g.privacyField=i}var j=b.textbox().mentions("controller").toArray();g.mentions=a.map(j,function(b){return"hashtag"!==b.type&&"emoticon"!==b.type||!a.isPlainObject(b.value)||(b.value=b.value.title.slice(1)),JSON.stringify(b)})},"{submitButton} click":function(){b.save(b.isEdit)},"{privacyButton} click":function(a){setTimeout(function(){a.find("[data-es-privacy-container]").hasClass("active")},1)},metas:{friends:"",location:"",mood:""},currentMeta:null,getMeta:function(a){var c={name:a,button:b.metaButton().filterBy("storyMetaButton",a),content:b.metaContent().filterBy("storyMetaContent",a)};return c.button.length<1||c.content.length<1?null:c},activateMeta:function(a){var e=b.getMeta(a);if(e&&(b.deactivateMeta(b.currentMeta),b.giphyMetaContent().addClass("t-hidden"),e.button.addClass("active"),e.content.appendTo(b.metaContents()).addClass("active"),b.currentMeta=a,b.trigger("activateMeta",[e]),d.addClass("has-meta"),"giphy"==a)){b.giphyMetaContent().removeClass("t-hidden"),c.currentGiphy&&b.giphyLoaderWrapper().addClass("t-hidden");var f=b.giphyBrowser().length>0;f||(b.giphyLoader().addClass("is-active"),EasySocial.ajax("site/views/giphy/getForm",{from:"story"}).done(function(a){b.giphyWrapper().html(a),b.giphyLoader().removeClass("is-active")}))}},deactivateMeta:function(a){var c=b.getMeta(a);c&&(c.button.removeClass("active"),c.content.removeClass("active"),b.currentMeta=null,b.trigger("deactivateMeta",[c]),d.removeClass("has-meta"))},toggleMeta:function(a){b.currentMeta==a?b.deactivateMeta(a):b.activateMeta(a)},getMetaText:function(){var c=b.metas,d=[];return a.each(["friends","location","mood"],function(a,b){var e=c[b];e&&d.push(e)}),d.join(" ")},setMeta:function(a,c){b.metas[a]=c,b.updateMeta()},updateMeta:a.debounce(function(){var c=b.getMetaText(),d=b.meta(),e=b.textField();if(a.each(b.metas,function(a,c){var d=b.getMeta(a);d&&d.button.toggleClass("has-content",!!c)}),!c)return d.remove(),e.attr("placeholder",b.placeholder),void 0;var f=b.mentionsMetaOverlay();d.length<1&&(d=a('<u class="es-story-meta" data-story-meta data-ignore></u>').appendTo(f));var g="rtl"==f.css("direction")?"&#8207;":"";d.html(g+" &mdash; "+c),e.attr("placeholder",""),b.setMentionsLayout()},1),refreshMeta:function(){b.trigger("refreshMeta"),b.updateMeta()},"{textbox} triggerClear":function(){b.refreshMeta()},"{meta} click":function(c,d){a(d.target).is("a")||b.textField().focus()},"{metaButton} click":function(a){var c=a.attr("data-story-meta-button");b.toggleMeta(c)},clearSchedule:function(){b.scheduled().length>0&&(b.scheduled().find("#scheduled").val(""),b.scheduled().find("[data-story-scheduled-indicator]").removeClass("active"))}}}),EasySocial.Controller("Scheduled.DateTime",{defaultOptions:{"{picker}":"[data-picker]","{datetime}":"[data-scheduled-datetime]","{indicator}":"[data-story-scheduled-indicator]"}},function(b){return{init:function(){var d=new a.moment,e=(new Date).getFullYear()+10,f=b.picker().parents().find("[data-story-scheduled]").data("dateformat"),g="DD-MM-YYYY hh:mm A";if(24==f)var g="DD-MM-YYYY HH:mm";d.date(d.date()-1),b.picker()._datetimepicker({component:"es",useCurrent:!1,format:g,minDate:d,maxDate:new a.moment({y:e}),icons:{time:"far fa-clock",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down"},sideBySide:!1,pickTime:1,minuteStepping:1,language:c,header:b.picker().data("scheduledPost"),width:300});var h=b.element.data("value");if(""!=h){var i=a.moment(h);b.datetimepicker("setDate",i)}},datetimepicker:function(a,c){return b.picker().data("DateTimePicker")[a](c)},"{picker} dp.change":function(a,c){b.indicator().addClass("active"),b.setDateValue(c.date.toDate())},setDateValue:function(a){b.datetime().val(a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2)+"-"+("00"+a.getDate()).slice(-2)+" "+("00"+a.getHours()).slice(-2)+":"+("00"+a.getMinutes()).slice(-2)+":"+("00"+a.getSeconds()).slice(-2))}}}),b.resolve()})});
EasySocial.module("uploader/uploader",function(a){var b=this;EasySocial.require().library("plupload").script("uploader/queue").done(function(){EasySocial.Controller("Uploader",{defaults:{url:a.indexUrl+"?option=com_easysocial&controller=uploader&task=uploadTemporary&format=json&tmpl=component&"+EasySocial.token()+"=1",uploaded:[],query:"",plupload:"",dropArea:"uploaderDragDrop",extensionsAllowed:"jpg,jpeg,png,gif",temporaryUpload:!1,files:[],"{uploaderForm}":"[data-uploader-form]","{uploadButton}":"[data-uploader-browse]","{uploadArea}":".uploadArea","{queue}":"[data-uploaderQueue]","{queueItem}":"[data-uploaderQueue-item]","{emptyFiles}":"[data-uploader-empty]","{removeFile}":"[data-uploaderQueue-remove]","{uploadCounter}":".uploadCounter"}},function(b,c){return{init:function(){b.queue().implement(EasySocial.Controller.Uploader.Queue),c.temporaryUpload&&(c.url=a.indexUrl+"?option=com_easysocial&controller=uploader&task=uploadTemporary&format=json&tmpl=component&"+EasySocial.token()+"=1"),""!=c.query&&(c.url=c.url+"&"+c.query),setTimeout(function(){b.uploaderForm().implement("plupload",{settings:{url:c.url,drop_element:c.dropArea,filters:[{title:"Allowed File Type",extensions:c.extensionsAllowed}]},"{uploader}":"[data-uploader-form]","{uploadButton}":"[data-uploader-browse]"},function(){c.plupload=this.plupload})},1)},createFileItem:function(d){a.each(d,function(d,e){if(!b.getItem(e)){var f=a("[data-uploaderQueue-item-template]"),g=f.clone();g.removeClass("t-hidden"),g.removeAttr("data-uploaderQueue-item-template"),g.attr("id",e.id),g.find("[data-filename]").text(e.name),g.find("[data-filesize]").text(b.formatSize(e.size)),a(g).implement(EasySocial.Controller.Uploader.Queue.Item,{"{uploader}":b}),b.items[e.id]=g,c.files.push(e),b.emptyFiles().hide(),b.queue().append(g)}})},formatSize:function(a){var b=parseInt(a/1024);return b},reset:function(){a("[data-uploaderQueue-item].is-done").remove()},removeItem:function(c){var d=a("#"+c),e=a(d).find("input[name=upload-id\\[\\]]").val();return d.remove(),e?(EasySocial.ajax("site/controllers/uploader/delete",{id:e}).done(function(){b.options.plupload.removeFile(b.options.plupload.getFile(c))}),delete b.items[c],void 0):(b.options.plupload.removeFile(b.options.plupload.getFile(c)),void 0)},startUpload:function(){b.upload()},upload:function(){b.options.plupload.files.length>0&&(b.options.uploading=!0,b.options.plupload.start())},hasFiles:function(){return b.options.files.length>0},"{uploaderForm} FilesAdded":function(d,e,f,g){if(b.createFileItem(g),c.temporaryUpload){var h=[],i=0;a(g).each(function(a,b){i+=b.size,h.push(b.size)}),EasySocial.ajax("site/controllers/uploader/checkFileSize",{filesize:h,totalsize:i}).done(function(){b.startUpload()}).fail(function(a){b.uploaderForm().trigger("Error",[f,{message:a}])})}},items:{},getItem:function(c){var d;return a.isString(c)&&(d=c),c&&c.id&&(d=c.id),b.items[d]},"{uploaderForm} UploadProgress":function(a,c,d,e){e&&b.queueItem("#"+e.id).trigger("UploadProgress",e)},"{uploaderForm} FileUploaded":function(a,c,d,e,f){b.queueItem("#"+e.id).trigger("FileUploaded",[e,f])},"{uploaderForm} UploadComplete":function(){b.options.uploading=!1},"{uploaderForm} Error":function(a,c,d,e){b.clearMessage();var f={message:e.message,type:"error"};b.setMessage(f)},"{uploaderForm} FileError":function(a,c,d,e,f){var g={message:f.message,type:"error"};b.setMessage(g),b.queueItem("#"+e.id).trigger("FileError",[e,f])}}}),b.resolve()})});
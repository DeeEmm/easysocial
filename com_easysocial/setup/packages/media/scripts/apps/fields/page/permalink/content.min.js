EasySocial.module("apps/fields/page/permalink/content",function(a){var b=this;EasySocial.Controller("Field.Page.Permalink",{defaultOptions:{required:!1,max:0,id:null,pageid:null,userid:null,"{field}":"[data-field-permalink]","{checkButton}":"[data-permalink-check]","{input}":"[data-permalink-input]","{available}":"[data-permalink-available]"}},function(b,c){return{state:!1,init:function(){c.max=b.field().data("max")},enableInput:function(){b.input().removeClass("disabled").removeAttr("disabled")},disableInput:function(){b.input().addClass("disabled").attr("disabled",!0)},"{self} onTitleKeyup":function(c,d,e){var e=a.trim(e);!e||e.length<=0||(b.disableInput(),EasySocial.ajax("fields/page/permalink/generate",{title:e}).done(function(a){b.input().val(a).trigger("keyup"),b.enableInput()}))},"{self} onRender":function(){var a=b.field().htmlData();c.error=a.error||{}},"{checkButton} click":function(){b.delayedCheck()},"{input} keyup":function(){b.delayedCheck()},delayedCheck:a.debounce(function(){b.checkPermalink()},250),checkPermalink:function(){b.clearError();var d=b.input().val();if(b.available().hide(),b.options.max>0&&d.length>b.options.max)return b.raiseError(c.error.max),!1;if(!a.isEmpty(d)){b.checkButton().addClass("is-loading");var e=a.Deferred();return EasySocial.ajax("fields/page/permalink/isValid",{id:b.options.id,pageid:b.options.pageid,permalink:d}).done(function(){b.clearError(),b.checkButton().removeClass("is-loading"),b.available().show(),e.resolve()}).fail(function(a){b.raiseError(a),b.checkButton().removeClass("is-loading"),b.available().hide(),e.reject()}),e}return b.options.required&&a.isEmpty(d)?(b.available().hide(),b.raiseError(c.error.required),!1):!0},raiseError:function(a){b.trigger("error",[a])},clearError:function(){b.trigger("clear")},"{self} onSubmit":function(a,c,d){d.push(b.checkPermalink())}}}),b.resolve()});
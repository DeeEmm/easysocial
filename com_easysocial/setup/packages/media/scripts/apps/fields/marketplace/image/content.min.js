EasySocial.module("apps/fields/marketplace/image/content",function(){var b=this;EasySocial.require().script("shared/uploader").done(function(a){EasySocial.Controller("Field.Image",{defaultOptions:{required:!1,id:null,inputName:"","{field}":"[data-field-file]","{list}":"[data-field-file-list]","{item}":"[data-field-file-item]","{add}":"[data-field-file-add]","{dragPlaceholder}":".data-field-file-item-drag","{moveHandle}":"[data-field-file-move]","{albumView}":"[data-album-view]","{albumContent}":"[data-album-content]","{uploadButton}":"[data-album-upload-button]","{photoItemGroup}":"[data-photo-item-group]","{photoNewItem}":"[data-photo-item][data-photo-edit='0']","{photoItem}":"[data-photo-item]","{photoImage}":"[data-photo-image]","{photoRemoveButton}":"[data-photo-remove-button]","{uploadItem}":"[data-photo-upload-item]","{uploadRemoveButton}":".upload-remove-button","{removedPhotos}":"[data-removed-photos]","{photosCount}":"[data-photos-count]"}},function(b,c){return{init:function(){var d=b.field().htmlData();c.error=d.error||{},c.message=d.message||{},b.item().addController("EasySocial.Controller.Field.File.Item",{parent:b,message:c.message,error:c.error}),c.photosRemove=[],b.uploader=b.albumView().addController(EasySocial.Controller.Albums.Uploader,a.extend({"{uploadButton}":b.uploadButton.selector,"{uploadItemGroup}":b.photoItemGroup.selector,"{uploadDropsite}":b.albumContent.selector},{settings:b.options.uploader})),b.photoItemGroup().css("opacity",1),b.addPlugin("uploader",b.uploader),b.setLayout()},"{self} onRender":function(){var a=b.field().htmlData();c.error=a.error||{}},raiseError:function(a){b.trigger("error",[a])},clearError:function(){b.trigger("clear")},hasItems:function(){var a=b.photoItem().length>0,c=b.uploadItem().length>0;return a||c},setLayout:function(){b.albumView().toggleClass("has-photos",b.hasItems())},activateAttachment:function(){},removePhoto:function(a){var d=b.photoItem().filterBy("photoId",a);"1"==d.data("photoEdit")&&c.photosRemove.push(a),d.remove(),b.removedPhotos().val(c.photosRemove),b.photosCount().val(b.photoItem().length),b.setLayout()},clearPhoto:function(){b.photoItem().remove(),b.uploadItem().remove(),b.setLayout()},totalsize:0,"{uploader} FilesAdded":function(d,e,f,g){var h=[];b.clearError(),a(g).each(function(a,c){b.totalsize=b.totalsize+c.size,h.push(c.size)}),EasySocial.ajax("site/controllers/photos/checkFileSize",{filesize:h,totalsize:b.totalsize,uid:c.uid,utype:c.utype}).done(function(){b.setLayout(),b.uploader.start()}).fail(function(a){b.raiseError(a)})},"{uploader} FileUploaded":function(c,d,e,f,g){var h=b.uploader.getItem(f),i=a(a.parseHTML(a.trim(g.html)));i.addClass("new-item").insertAfter(h.element),b.uploader.removeItem(f.id),b.setLayout(),setTimeout(function(){i.removeClass("new-item")},1),b.photosCount().val(b.photoItem().length)},"{uploader} FileError":function(a,c,d,e,f){b.raiseError(f.message);var g=b.uploadingPhoto;g&&(g.reject(),delete b.uploadingPhoto),b.uploader.removeItem(e.id),b.setLayout()},"{uploader} Error":function(a,d,e,f){var g=c.errors[f.code]||f.message;b.raiseError(g);var h=b.uploadingPhoto;h&&(h.reject(),delete b.uploadingPhoto),b.uploadRemoveButton().click(function(){setTimeout(function(){b.setLayout()},1)}),b.setLayout()},"{photoRemoveButton} click":function(a){var d=(b.photoItem().length,a.parent(b.photoItem.selector)),e=d.data("photoId");void 0===e&&d.remove(),b.removePhoto(e)},validateInput:function(){return b.clearError(),b.hasItems()?!0:(b.raiseError(c.errors.noEmptyAllowed),!1)},"{self} onSubmit":function(a,c,d){d.push(b.validateInput())}}}),b.resolve()})});
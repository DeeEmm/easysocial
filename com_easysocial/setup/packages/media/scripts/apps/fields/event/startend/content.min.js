EasySocial.module("apps/fields/event/startend/content",function(){var b=this,c=EasySocial.options.momentLang;EasySocial.require().library("datetimepicker","moment/"+c,"chosen").done(function(a){EasySocial.Controller("Field.Event.Startend",{defaultOptions:{dateFormat:"",allowTime:!0,allowTimezone:!0,disallowPast:!1,minuteStepping:15,yearfrom:"",yearto:"",requiredEnd:!1,allday:!1,calendarLanguage:"english",dow:0,"{field}":"[data-field-startend]","{startForm}":"[data-event-start]","{endForm}":"[data-event-end]","{timezone}":"[data-event-timezone]"}},function(b,c){return{init:function(){var d=b.field().htmlData();c.error=d.error||{},b.options.yearto=a.isEmpty(b.options.yearto)?(new Date).getFullYear()+100:parseInt(b.options.yearto)+1,b.options.yearfrom=b.options.yearfrom||1930,b.startDatetime=b.startForm().addController("EasySocial.Controller.Field.Event.Startend.Form",{"{parent}":b,type:"start"}),b.endDatetime=b.endForm().addController("EasySocial.Controller.Field.Event.Startend.Form",{"{parent}":b,type:"end"}),b.timezone().length>0&&(b.timezone().on("chosen:ready",function(b){var c=a(b.currentTarget.nextSibling);a(c).addClass("chosen-container-single--es-timezone")}),b.timezone().chosen({allow_single_deselect:!0,search_contains:!0}))},"{self} onSubmit":function(a,c,d){d.push(b.validateInput())},validateInput:function(){return b.clearError(),a.isEmpty(b.startDatetime.datetime().val())?(b.raiseError(c.error.start.required),!1):b.options.requireEnd&&a.isEmpty(b.endDatetime.datetime().val())?(b.raiseError(c.error.end.required),!1):!0},raiseError:function(a){b.trigger("error",[a])},clearError:function(){b.trigger("clear")}}}),EasySocial.Controller("Field.Event.Startend.Form",{defaultOptions:{type:null,"{picker}":"[data-picker]","{toggle}":"[data-picker-toggle]","{datetime}":"[data-datetime]"}},function(b,d){return{init:function(){b.load()},"{window} easysocial.fields.startend.start.change":function(){"start"==d.type&&b.parent.endDatetime&&(b.parent.endDatetime.datetimepicker("destroy"),b.parent.endDatetime.load())},"{window} easysocial.fields.allday.change":function(a,c,d){b.datetimepicker("destroy"),b.parent.options.allday=1==d?!0:!1,b.load()},load:function(){var e=new a.moment;if(b.parent.options.disallowPast?e.date(e.date()-1):e.year(b.parent.options.yearfrom),"end"==d.type){var f=b.parent.startDatetime.datetime().val();if(f)var e=a.moment(f),e=e.date(e.date()-1)}var g=b.parent.options.allowTime&&!b.parent.options.allday,h=b.parent.options.dateFormat;g||(h=h.substr(0,10)),b.picker()._datetimepicker({component:"es",useCurrent:!1,format:h,minDate:e,maxDate:new a.moment({y:b.parent.options.yearto}),icons:{time:"far fa-clock",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down"},sideBySide:!1,pickTime:g,minuteStepping:parseInt(b.parent.options.minuteStepping),language:"english"==b.parent.options.calendarLanguage?"en-gb":c,dow:b.parent.options.dow});var i=b.datetime().val();if(!a.isEmpty(i)){var j=a.moment(i);b.datetimepicker("setDate",j)}if("end"==d.type){var f=b.parent.startDatetime.datetime().val();if(f){var k=a.moment(f);if(a.isEmpty(i))b.datetimepicker("setDate",k),b.datetimepicker("setDate",""),b.datetime().val("");else{var l=a.moment(i);k.unix()>l.unix()&&b.datetimepicker("setDate",k)}}}},datetimepicker:function(a,c){return b.picker().data("DateTimePicker")[a](c)},"{toggle} click":function(){b.picker().focus()},"{picker} dp.change":function(c,e){b.setDateValue(e.date.toDate()),a(window).trigger("easysocial.fields.startend."+d.type+".change",[e.date])},"{picker} change":function(c){a.isEmpty(c.val())&&b.datetime().val("")},setDateValue:function(a){b.datetime().val(a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2)+"-"+("00"+a.getDate()).slice(-2)+" "+("00"+a.getHours()).slice(-2)+":"+("00"+a.getMinutes()).slice(-2)+":"+("00"+a.getSeconds()).slice(-2))}}}),b.resolve()})});
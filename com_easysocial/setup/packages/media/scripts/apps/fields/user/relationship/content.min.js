EasySocial.module("apps/fields/user/relationship/content",function(){var b=this;EasySocial.require().script("site/friends/suggest").done(function(a){EasySocial.Controller("Field.Relationship",{defaultOptions:{required:!1,id:null,types:null,fieldname:null,actor:null,target:null,userid:null,"{type}":"[data-rs-type]","{request}":"[data-rs-request]","{field}":"[data-field-relationship]","{pendingTitle}":"[data-rs-pending-title]","{relations}":"[data-rs-relations]","{delete}":"[data-rs-delete]","{rejectRequest}":"[data-rs-reject]","{approveRequest}":"[data-rs-approve]"}},function(b,c){return{init:function(){EasySocial.module("field.relationship/"+c.id).done(function(a){b.options.types=a}),b.addPlugin("form")},getRequestId:function(){return b.request().data("id")},getRequestWrapper:function(b){return wrapper=a('[data-rs-request][data-id="'+b+'"]')},showTypeSelection:function(){b.type().val(b.type().children(":first").val()),b.type().removeClass("t-hidden").show(),b.type().removeAttr("disabled")},"{self} relationshipDeleted":function(){b.showTypeSelection()},"{delete} click":function(a,d){d.stopPropagation(),d.preventDefault(),a.addClass("is-loading"),EasySocial.ajax("fields/user/relationship/delete",{id:c.id,userid:c.userid,relid:b.getRequestId()}).done(function(){a.removeClass("is-loading"),b.relations().remove(),b.showTypeSelection()})},"{approveRequest} click":function(d){var f=d.data("id");d.addClass("is-loading"),EasySocial.ajax("fields/user/relationship/approve",{id:c.id,relid:f,inputName:c.fieldname}).done(function(c){a("[data-rs-request-hidden]").remove(),wrapper=b.getRequestWrapper(f),d.removeClass("is-loading"),b.request().not(wrapper).remove(),wrapper.replaceWith(c)})},"{rejectRequest} click":function(a,d){d.preventDefault(),d.stopPropagation();var e=a.data("id");EasySocial.ajax("fields/user/relationship/reject",{id:c.id,relid:e}).done(function(){wrapper=b.getRequestWrapper(e),wrapper.remove(),b.trigger("relationshipDeleted")})}}}),EasySocial.Controller("Field.Relationship.Form",{defaultOptions:{"{field}":"[data-field-relationship]","{type}":"[data-rs-type]","{input}":"[data-rs-input]","{target}":"[data-rs-target]","{targetAvatar}":"[data-rs-target-avatar]","{targetName}":"[data-rs-target-name]","{targetDelete}":"[data-rs-form-delete]","{textboxlistDelete}":"[data-textboxlist-itemRemoveButton]",target:!1}},function(b,c){return{init:function(){b.input().addController(EasySocial.Controller.Friends.Suggest,{max:1,name:b.parent.options.fieldname+"[target][]"});var a=b.field().htmlData();a&&a.error&&(c.error=a.error),c.target=!0},"{self} onRender":function(){var a=b.field().htmlData();c.error=a.error},"{type} change":function(a){var f=(a.val(),a.find(":selected")),g=f.data("connection")?!0:!1;return c.target=!1,g?(b.input().controller("Textboxlist").clearItems(),b.target().hide(),b.input().show(),b.validateInput(c.error.target),void 0):(c.target=!0,b.clearError(),b.input().hide(),b.target().hide(),void 0)},"{input} addItem":function(d,e,f){var f=a("<div/>").html(f.html),g=f.find("[data-suggest-avatar]").attr("src"),h=f.find("[data-suggest-title]").val(),i=f.find("[data-suggest-id]").val();g&&b.targetAvatar().attr("src",g),h&&b.targetName().text(h),i&&b.targetDelete().data("id",i),b.input().hide(),b.target().show(),c.target=!0,b.clearError()},"{input} blur":function(){b.validateInput(c.error.target)},"{targetDelete} click":function(a){var e=a.data("id");b.input().controller("Textboxlist").removeItem(e),b.type().removeAttr("disabled"),b.input().show(),b.target().hide(),c.target=!1,b.validateInput(c.error.target)},"{self} onSubmit":function(a,d,e){e.push(b.validateInput(c.error.target))},validateInput:function(){var e=b.parent.options.required,f=b.type().val(),g=["na","single","widowed","separated","divorced","relationshipnotarget","engagednotarget","marriednotarget","complicatednotarget"];return e&&"na"==f?(b.raiseError(c.error.required),!1):e||-1===a.inArray(f,g)?-1!==a.inArray(f,g)||c.target?(b.clearError(),!0):(b.raiseError(c.error.target),!1):(b.clearError(),!0)},raiseError:function(a){a||(a=c.error.required),b.trigger("error",[a])},clearError:function(){b.trigger("clear")}}}),b.resolve()})});
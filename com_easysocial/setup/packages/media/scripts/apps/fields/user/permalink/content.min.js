EasySocial.module("apps/fields/user/permalink/content",function(a){var b=this;EasySocial.Controller("Field.Permalink",{defaultOptions:{required:!1,max:0,id:null,userid:null,"{field}":"[data-field-permalink]","{checkButton}":"[data-permalink-check]","{input}":"[data-permalink-input]","{available}":"[data-permalink-available]"}},function(b,c,d){return{state:!1,init:function(){c.message={length:d.find("[data-error-length]").data("error-length"),required:d.find("[data-error-required]").data("error-required")},c.max=b.field().data("max")},"{checkButton} click":function(){b.delayedCheck()},"{input} keyup":function(){b.delayedCheck()},delayedCheck:a.debounce(function(){b.checkPermalink()},250),checkPermalink:function(){b.clearError();var d=b.input().val();if(b.available().hide(),b.options.max>0&&d.length>b.options.max)return b.raiseError(c.message.length),!1;if(!a.isEmpty(d)){b.checkButton().addClass("is-loading");var e=a.Deferred();return EasySocial.ajax("fields/user/permalink/isValid",{id:b.options.id,userid:b.options.userid,permalink:d}).done(function(){b.checkButton().removeClass("is-loading"),b.available().show(),e.resolve()}).fail(function(a){b.raiseError(a),b.checkButton().removeClass("is-loading"),b.available().hide(),e.reject()}),e}return b.options.required&&a.isEmpty(d)?(b.available().hide(),b.raiseError(c.message.required),!1):!0},raiseError:function(a){b.trigger("error",[a])},clearError:function(){b.trigger("clear")},"{self} onSubmit":function(a,c,d){d.push(b.checkPermalink())}}}),b.resolve()});
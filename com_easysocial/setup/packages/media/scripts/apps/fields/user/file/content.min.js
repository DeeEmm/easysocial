EasySocial.module("apps/fields/user/file/content",function(){var b=this;EasySocial.require().library("ui/sortable").done(function(a){EasySocial.Controller("Field.File",{defaultOptions:{required:!1,id:null,inputName:"",maxFile:0,"{field}":"[data-field-file]","{list}":"[data-field-file-list]","{item}":"[data-field-file-item]","{add}":"[data-field-file-add]","{dragPlaceholder}":".data-field-file-item-drag","{moveHandle}":"[data-field-file-move]"}},function(b,c){return{init:function(){var a=b.field().htmlData();c.error=a.error||{},c.message=a.message||{},c.maxFile=b.field().data("maxfile"),b.item().addController("EasySocial.Controller.Field.File.Item",{parent:b,message:c.message,error:c.error}),b.initSortable()},initSortable:function(){b.list().sortable({items:b.item.selector,placeholder:"data-field-file-item-drag",handle:b.moveHandle.selector,forcePlaceholderSize:!0,start:function(a,c){b.dragPlaceholder().width(c.item.find(".file-wrap").width())}})},"{add} click":function(d){if(b.options.maxFile<1||b.item().length<b.options.maxFile){var f=b.item().length,g=a('<div class="data-field-file-item" data-field-file-item></div>');g.data("key",f),g.html(c.message.working),g.addController("EasySocial.Controller.Field.File.Item",{parent:b,message:c.message,error:c.error}),b.list().append(g),EasySocial.ajax("fields/user/file/getUploadHtml",{id:b.options.id,key:f}).done(function(a){g.html(a)}),b.options.maxFile>1&&b.item().length>=b.options.maxFile&&d.hide()}},"{item} uploadDone":function(){b.add().click()}}}),EasySocial.Controller("Field.File.Item",{defaultOptions:{required:!1,key:null,"{upload}":"[data-field-file-upload]","{progress}":"[data-field-file-progress]","{delete}":"[data-field-file-delete]","{clear}":"[data-field-file-clear]","{id}":"[data-field-file-id]","{tmp}":"[data-field-file-tmp]"}},function(b,c){return{init:function(){c.key=b.element.data("key")},"{upload} change":function(a){b.element.html(c.message.working),EasySocial.ajax("fields/user/file/upload",{id:c.parent.options.id,files:a,key:b.options.key},{type:"iframe"}).done(function(a){b.element.html(a),b.trigger("uploadDone")}).fail(function(a){b.element.html(a||b.getErrorMsg())})},"{delete} click":function(){var e=b.tmp().val(),f=b.id().val();b.element.html(c.message.working),EasySocial.ajax("fields/user/file/delete",{id:c.parent.options.id,key:b.options.key,tmp:e,fileid:f}).done(function(a){b.element.html(a),b.trigger("fileDeleted")}).fail(function(a){b.element.html(a||b.getErrorMsg())})},"{clear} click":function(){b.element.html(c.message.working),EasySocial.ajax("fields/user/file/getUploadHtml",{id:c.parent.options.id,key:b.options.key}).done(function(a){b.element.html(a)})},getErrorMsg:function(){return msg=a('<span class="alert field-file-error">'+c.error.unknown+'<button class="close" type="button" data-field-file-clear>\xd7</button></span>')}}}),b.resolve()})});
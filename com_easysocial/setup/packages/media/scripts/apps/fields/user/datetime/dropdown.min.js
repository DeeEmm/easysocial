EasySocial.module("apps/fields/user/datetime/dropdown",function(a){var b=this;EasySocial.Controller("Field.Datetime.Dropdown",{defaultOptions:{required:!1,allowTime:!1,allowTimezone:!1,yearfrom:null,yearto:null,ageLimit:null,"{dateValue}":"[data-field-datetime-value]","{year}":"[data-field-datetime-year]","{month}":"[data-field-datetime-month]","{day}":"[data-field-datetime-day]","{hour}":"[data-field-datetime-hour]","{minute}":"[data-field-datetime-minute]","{ampm}":"[data-field-datetime-ampm]","{dayLabel}":"[data-datetime-day-label]"}},function(b,c){return{init:function(){b.checkDate()},"{year} change":function(){b.setValue(),b.checkDate(),b.month().trigger("change")},"{month} change":function(){var e=b.year().val(),f=b.month().val(),g=b.dayLabel().text();if(""!==e&&""!==f){var h=new Date(e,f,0).getDate(),j=b.day().val();for(""!==j&&(j=Math.min(j,h)),b.day().empty(),b.day().append('<option value="">'+g+"</option>"),i=1;h>=i;i++)a('<option value="'+i+'">'+i+"</option>").appendTo(b.day());""!==j&&b.day().val(j)}b.setValue(),b.checkDate()},"{day} change":function(){b.setValue(),b.checkDate()},"{hour} change":function(){b.setValue()},"{minute} change":function(){b.setValue()},"{ampm} change":function(){b.setValue()},checkDate:function(){b.clearError();var a=b.year().val(),d=b.month().val(),e=b.day().val();return""!=a&&""!=d&&""!=e||!c.required?b.validate().done(function(){b.clearError()}).fail(function(a){b.raiseError(a)}):(b.raiseError(),!1)},validate:function(){return EasySocial.ajax("fields/user/birthday/isValid",{id:0,value:b.dateValue().val(),age_limit:c.ageLimit,year_from:c.yearfrom,year_to:c.yearto})},setValue:function(){var a,c=b.year().val(),d=b.month().val(),e=b.day().val();if(""!==c&&""!==d&&""!==e){if(a=c+"-"+d+"-"+e,b.options.allowTime){var f=b.hour().val(),g=b.minute().val();""!==f&&b.ampm().length>0&&"pm"==b.ampm().val()&&(f=(parseInt(f)+12).toString(),"24"===f&&(f="0")),""===g&&(g="00"),a+=" "+("00"+f).slice(-2)+":"+("00"+g).slice(-2)+":00"}b.dateValue().val(a)}},"{self} onSubmit":function(a,c,d){d.push(b.checkDate())},clearError:function(){b.trigger("clear")},raiseError:function(a){b.trigger("error",[a])}}}),b.resolve()});